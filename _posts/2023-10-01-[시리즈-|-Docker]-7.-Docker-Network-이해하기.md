---
layout: post
date: 2023-10-01
title: "[ì‹œë¦¬ì¦ˆ | Docker] 7. Docker Network ì´í•´í•˜ê¸°"
tags: [Docker, ]
categories: [ì‹œë¦¬ì¦ˆ, Docker, ]
---


> ğŸ’¡ ë„¤ì´ë²„í´ë¼ìš°ë“œì˜ â€œ[**[Kubernetes Service] í´ë¼ìš°ë“œ ì‹œì¥ì˜ ëŒ€ì„¸, ì¿ ë²„ë„¤í‹°ìŠ¤ë€ ë¬´ì—‡ì¸ê°€?**](https://www.youtube.com/watch?v=JNc11rxLtmE&list=RDLVJNc11rxLtmE&start_radio=1&t=5s)â€ ë‚´ìš©ì„ í† ëŒ€ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.



### 1. Docker Network


![0](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/0.png)_ì¶œì²˜: https://captcha.tistory.com/m/70_


`Host`: ë¬¼ë¦¬ì ì¸ ë¨¸ì‹ 


`eth0(Host NIC)`: ë¬¼ë¦¬ì  ë¨¸ì‹ ì— ì¥ì°©ëœ ëœì¹´ë“œ



#### 1.1. Docker Networkë€? 


DockerëŠ” ê°™ì€ í˜¸ìŠ¤íŠ¸ì•ˆì—ì„œ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ê°€ êµ¬ì„±ë˜ì–´ ì‹¤í–‰ëœë‹¤. 
ì´ê²ƒì„ **Docker Network**ë¼ê³ í•œë‹¤.
ì¦‰, ì‹¤í–‰ì¤‘ì¸ ê°ê°ì˜ ì»¨í…Œì´ë„ˆë¼ë¦¬ ì—°ê²°í•˜ê¸° ìœ„í•œ ë…¼ë¦¬ì ì¸ ë„¤íŠ¸ì›Œí¬ì´ë‹¤.

- dockerê°€ ì„¤ì¹˜ë˜ë©´ ê¸°ë³¸ìœ¼ë¡œ [**`bridge`**](https://intrepidgeeks.com/tutorial/docker-network-host-none)[**,** ](https://intrepidgeeks.com/tutorial/docker-network-host-none)[**`host`**](https://intrepidgeeks.com/tutorial/docker-network-host-none)[**,** ](https://intrepidgeeks.com/tutorial/docker-network-host-none)[**`none`**](https://intrepidgeeks.com/tutorial/docker-network-host-none)ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ Networkê°€ ìƒì„±ëœë‹¤.
- ê·¸ë¦¬ê³  `bridge` ë„¤íŠ¸ì›Œí¬ì—ëŠ” `docker0`ì´ ë¼ëŠ” ì´ë¦„ì˜ ë¸Œë¦¿ì§€ê°€ ê¸°ë³¸ìœ¼ë¡œ ìƒì„±ëœë‹¤.
- ëª¨ë“  ì»¨í…Œì´ë„ˆëŠ” Docker Networkì•ˆì— ì¡´ì¬í•œë‹¤.
- ëª¨ë“  ì»¨í…Œì´ë„ˆëŠ” ë¸Œë¦¿ì§€ë¥¼ í†µí•´ì„œë§Œ ë‚´ë¶€, ì™¸ë¶€ í†µì‹ ì„ í•  ìˆ˜ ìˆë‹¤.
- docker networkëŠ” clië¥¼ í†µí•´ ì¶”ê°€ë¡œ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, docker-composeë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ìœ¼ë¡œ ìƒˆë¡œìš´ docker networkê°€ ìƒì„±ëœë‹¤.


### 2. `docker0` ë¸Œë¦¿ì§€


![1](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/1.png)_ì¶œì²˜: https://www.youtube.com/watch?v=JNc11rxLtmE&list=RDLVJNc11rxLtmE&start_radio=1&rv=JNc11rxLtmE&t=5_


[`iptables`](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=alice_k106&logNo=221305928714): ì¸ì•„ì›ƒì„ ê´€ë¦¬í•˜ëŠ” í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë°©í™”ë²½ í”„ë¡œê·¸ë¨ì¸ ufwì€ iptablesë¥¼ ë˜í•‘í•˜ì—¬ ë§Œë“¤ì—ˆë‹¤.


`L2`: OSI 7ê³„ì¸µì—ì„œ 2ê³„ì¸µì¸ ë°ì´í„°ë§í¬ ê³„ì¸µìœ¼ë¡œ bridgeê°€ ì—¬ê¸°ì— ì†í•œë‹¤.



#### 2.1. `docker0` ë¸Œë¦¿ì§€ë€?


`docker0`ëŠ” docker ì„¤ì¹˜ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” default ë¸Œë¦¿ì§€ì´ë‹¤.

- í˜¸ìŠ¤íŠ¸ pc í„°ë¯¸ë„ì—ì„œ `ifconfig docker0` ëª…ë ¹ìœ¼ë¡œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.
undefined<details>
  <summary>ê²°ê³¼ í™•ì¸</summary>


![2](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/2.png)



  </details>- dockerê°€ ì„¤ì¹˜ë˜ë©´ `docker0`ëŠ” ë‚´ë¶€ ì£¼ì†Œë¡œ 172.17.0.1(Gateway)ë¥¼ ê°€ì§„ë‹¤.
- í˜¸ìŠ¤íŠ¸ pcì—ì„œ `docker run`ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆë“¤ì€ defaultë¡œ `bridge` ë„¤íŠ¸ì›Œí¬ì— ë°°ì •ë˜ë©° `docker0`ì— ë°”ì¸ë”©ëœë‹¤.
- ë˜í•œ `bridge` ë„¤íŠ¸ì›Œí¬ì˜ ë‚´ë¶€í†µì‹ ì€ `docker0`ë¥¼ í†µí•´ì„œë§Œ ê°€ëŠ¥í•˜ë‹¤.
- ì™¸ë¶€ì—ì„œ `bridge` ë„¤íŠ¸ì›Œí¬ì˜ ë‚´ë¶€ ì»¨í…Œì´ë„ˆì™€ í†µì‹ ì„ í• ë•Œë„ `docker0`ë¥¼ í†µí•´ì„œë§Œ ê°€ëŠ¥í•˜ë‹¤.
- ì¦‰, `bridge` ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°œìƒí•˜ëŠ” ëª¨ë“  in/out íŒ¨í‚·ì€ `docker0` ë¸Œë¦¿ì§€ë¥¼ í†µí•œë‹¤.
- ë¦¬ëˆ…ìŠ¤ì— ê¸°ë³¸ìœ¼ë¡œ ì„¤ì¹˜ëœ ëª…ë ¹ì¸ `brctl show`ë¥¼ ì‚¬ìš©í•´ `bridge`ì— ë°”ì¸ë”© ëœ ì»¨í…Œì´ë„ˆ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.


#### 2.2. `docker0` ì¶”ê°€ ì„¤ëª…


![3](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/3.png)

- k8sì—ì„œ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±ì‹œì—ëŠ” default ë¸Œë¦¿ì§€ê°€ `docker0`ê°€ ì•„ë‹Œ `CNI0`ê°€ ëœë‹¤.


### 3. Docker Network ëª…ë ¹ì–´ ì‹¤ìŠµ



#### 3.1. dockerì—ì„œ ì‚¬ìš©ì¤‘ì¸ Network í™•ì¸



{% raw %}
```bash
$ docker network ls

# ex) 
# NETWORK ID     NAME                    DRIVER    SCOPE
# be183c6bce5a   bridge                  bridge    local
# 5da1a727cca0   minikube                bridge    local
```
{% endraw %}


<details>
  <summary>ê²°ê³¼ í™•ì¸</summary>


![4](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/4.png)

- í˜„ì¬ PCì— ì¡´ì¬í•˜ëŠ” Docker Network ëª¨ë‘ ì¶œë ¥


  </details>

#### 3.2. Network ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ docker ë¸Œë¦¿ì§€ ì„¤ì • í™•ì¸



{% raw %}
```bash
$ docker inspect ${Network Name}
```
{% endraw %}


<details>
  <summary>`docker inspect bridge` ê²°ê³¼ë¥¼ ë³´ê³  ì„¤ëª…</summary>


![5](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/5.png)

- `"Name": "bridge"`:  ë„¤íŠ¸ì›Œí¬ ì´ë¦„
- `"Subnet": "172.17.0.0/16"`:  `bridge`ë„¤íŠ¸ì›Œí¬ì— í• ë‹¹ëœ ë‚´ë¶€ ip ëŒ€ì—­í­

	â‡’ `bridge` ë„¤íŠ¸ì›Œí¬ì˜ ë‚´ë¶€ ì»¨í…Œì´ë„ˆ IPëŠ” `Subnet`ì— í• ë‹¹ëœ ëŒ€ì—­í­ ì•ˆì—ì„œ ëœë¤ìœ¼ë¡œ ë°°ì •ëœë‹¤.

- `"Gateway": "172.17.0.1"`:  Gateway ì¦‰, `docker0`ê°€ ì‚¬ìš©ì¤‘ì¸ ë‚´ë¶€ IP
undefined<details>
  <summary>`ifconfig docker0`ë¡œ `docker0` ë¸Œë¦¿ì§€ê°€ ì‚¬ìš©ì¤‘ì¸ IP í™•ì¸</summary>


![6](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/6.png)



  </details>

  </details>

#### 3.3. í˜¸ìŠ¤íŠ¸ PCì˜ ë¦¬ëˆ…ìŠ¤ ë¸Œë¦¿ì§€ì— ë§ˆìš´íŠ¸ ë˜ì–´ ìˆëŠ” ì»¨í…Œì´ë„ˆ í™•ì¸



{% raw %}
```bash
$ brctl show
```
{% endraw %}


<details>
  <summary>`brctl show` ê²°ê³¼ë¥¼ ë³´ê³  ì„¤ëª…</summary>


![7](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/7.png)

- `docker0`ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ì—†ê¸° ë•Œë¬¸ì— `interfaces`ì— ëœ¨ì§€ ì•ŠëŠ”ë‹¤.
- `br-712c089d5e04`ë¼ëŠ” ë¸Œë¦¿ì§€ë¥¼ ì‚¬ìš©ì¤‘ì¸ `veth2ad682f` ì»¨í…Œì´ë„ˆê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


  </details>

### 4. Docker Network ë‚´ë¶€ í†µì‹  ë°©ë²• 3ê°€ì§€


![8](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/8.png)_ì¶œì²˜: https://www.youtube.com/watch?v=JNc11rxLtmE&list=RDLVJNc11rxLtmE&start_radio=1&rv=JNc11rxLtmE&t=5_


[East - Wast Communiction](https://courage1.tistory.com/m/37): ë°ì´í„° ì„¼ì„œ ë‚´ë¶€ì—ì„œ ë°œìƒë˜ëŠ” íŠ¸ë˜í”½ìœ¼ë¡œ ì„œë²„ì™€ ì„œë²„ê°„ì˜ íŠ¸ë˜í”½



#### 4.1. ë¦¬ëˆ…ìŠ¤ ë¸Œë¦¿ì§€(`docker0`)ë¥¼ ì‚¬ìš©í•œ ë‚´ë¶€ í†µì‹  

- Docker Networkì•ˆì˜ ì»¨í…Œì´ë„ˆ ë¼ë¦¬ëŠ” íŠ¹ë³„í•œ ì„¤ì •ì—†ì´ë„ ë¸Œë¦¿ì§€ë¥¼ í†µí•´ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.
- ì„¤ì •ì„ í†µí•´ Docker Network ì•ˆì—ì„œ íŠ¹ì • ì»¨í…Œì´ë„ˆë¥¼ ê²©ë¦¬í•  ìˆ˜ ìˆë‹¤.
- ì„¤ì •ì„ í†µí•´ Docker Network ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë„ ê³„ì¸µí™” í•  ìˆ˜ ìˆë‹¤.


#### 4.2. Linkingì„ ì‚¬ìš©í•œ í†µì‹ 


![9](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/9.png)_ì¶œì²˜: https://www.youtube.com/watch?v=JNc11rxLtmE&list=RDLVJNc11rxLtmE&start_radio=1&rv=JNc11rxLtmE&t=5_

- linkë¥¼ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ Docker Network ì•ˆì—ì„œ ë¸Œë¦¿ì§€ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ì»¨í…Œì´ë„ˆê°„ì— ë‹¤ì´ë ‰íŠ¸ë¡œ í†µì‹ ì´ ê°€ëŠ¥í•˜ë‹¤.


#### 4.3. Custom Networkë¥¼ ì‚¬ìš©í•œ í†µì‹ 


![10](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/10.png)_ì¶œì²˜: https://www.youtube.com/watch?v=JNc11rxLtmE&list=RDLVJNc11rxLtmE&start_radio=1&rv=JNc11rxLtmE&t=5_

- docker cliì—ì„œ ì œê³µ ëª…ë ¹ì„ í†µí•´ ì‹ ê·œ Docker Networkë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
- ì‹ ê·œ Docker Networkê°€ ìƒì„±ë˜ë©´ `br-*`ë¼ëŠ” ê·œì¹™ìœ¼ë¡œ ë¦¬ëˆ…ìŠ¤ ë¸Œë¦¿ì§€ê°€ ìƒì„±ëœë‹¤.
- docker-composeë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ `docker-compose up`ëª…ë ¹ì„ í• ë•Œ ë§ˆë‹¤ ì‹ ê·œ Docker Networkê°€ ìƒì„±ëœë‹¤.


#### 4.4. í•œê³„


ìœ„ 3ê°€ì§€ ë°©ë²• ëª¨ë‘ Docker Networkì˜ ë‚´ë¶€ í†µì‹ ë§Œ ì§€ì›í•œë‹¤.
(ë¬¼ë¡  docker ëª…ë ¹ìœ¼ë¡œ ì™¸ë¶€ì— portë¥¼ í¬ì›Œë“œ í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í†µì‹ ì€ ê°€ëŠ¥í•˜ë‹¤.)


Docker NetworkëŠ” ê°™ì€ í˜¸ìŠ¤íŠ¸ì—ì„œë§Œ êµ¬ì„±ì´ ê°€ëŠ¥í•˜ë‹¤. ë•Œë¬¸ì— í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì—ì„œ ì¥ì• ê°€ ë°œìƒí•˜ë©´ ëª¨ë“  ì»¨í…Œì´ë„ˆì—ë„ ì¥ì• ê°€ ì „ë‹¬ëœë‹¤.
ì´ëŸ¬í•œ ì¥ì• ë¥¼ ê·¹ë³µí•˜ë ¤ë©´ ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ì— ë¶„ì‚°ëœ ì»¨í…Œì´ë„ˆ í™˜ê²½ì„ êµ¬ì„±í•´ì•¼ í•œë‹¤.


ì¦‰, ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ì— êµ¬ì„±ëœ Docker Networkê°„ì— í†µì‹ ì´ ê°€ëŠ¥í•´ì•¼í•œë‹¤.
(ê²°ë¡ : [Overlay Network](https://ko.wikipedia.org/wiki/%EC%98%A4%EB%B2%84%EB%A0%88%EC%9D%B4_%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC) add-on ë„ì…ì´ í•„ìš”í•˜ë‹¤.)


**ë‹¤ë¥¸ Docker Networkê°„ì— í†µì‹ (Overlay Network)**


![11](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/11.png)

- dockerì—ì„œ Overlay Networkë¥¼ ì§€ì›í•˜ë¼ë©´ ì¶”ê°€ì ì¸ í”ŒëŸ¬ê·¸ì¸ê³¼ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.
- **k8s ë˜í•œ ì´ëŸ¬í•œ ì»¨ì…‰ì„ ì°¨ìš©í•˜ì—¬ ë‚´ë¶€ì ìœ¼ë¡œ ë™ì‘í•œë‹¤.**


### 5. K8sì™€ Docker í†µì‹  ë¹„êµ 



#### 5.1. default ë¸Œë¦¿ì§€ `cni0`


![12](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/12.png)

- default ë¸Œë¦¿ì§€ë¡œ `cni0`ì´ ìƒì„±ëœë‹¤.
- `cni0`ëŠ” `docker0` ë¸Œë¦¿ì§€ì™€ ë™ì¼í•œ ì—­í• ì„ í•œë‹¤.
- ë©€í‹° í˜¸ìŠ¤íŠ¸ë“¤ì€ subnet ëŒ€ì—­í­ì´ ë‹¤ë¥´ë‹¤. â‡’ 10.224.0.0/16


#### 5.2. ì™¸ë¶€ í†µì‹  ë°©ë²• ë¹„êµ


![13](/assets/img/2023-10-01-ì‹œë¦¬ì¦ˆ--Docker-7.-Docker-Network-ì´í•´í•˜ê¸°.md/13.png)

- dockerëŠ” portë¥¼ exportí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ìˆë‹¤. 
(ì¦‰, ë¬´ì¡°ê±´ ì™¸ë¶€ì— ì—´ì–´ì•¼ í•œë‹¤.)
- k8sëŠ” TYPEë³„ë¡œ ë‹¤ë¥¸ ë™ì‘ì„ ì§€ì›í•œë‹¤.
	- ClusterIP: Pod ë‚´ë¶€ì—ì„œë§Œ í†µì‹ 
	- NodePort: 30000ë²ˆëŒ€ IPë¥¼ ì—´ì–´ì„œ ì™¸ë¶€ í†µì‹ 


### ì°¸ê³ 


[bookmark](https://www.youtube.com/watch?v=JNc11rxLtmE&list=RDLVJNc11rxLtmE&start_radio=1&t=5s)

