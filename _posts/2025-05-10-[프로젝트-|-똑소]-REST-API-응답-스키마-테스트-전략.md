---
layout: post
date: 2025-05-10
title: "[í”„ë¡œì íŠ¸ | ë˜‘ì†Œ] REST API ì‘ë‹µ ìŠ¤í‚¤ë§ˆ í…ŒìŠ¤íŠ¸ ì „ëµ"
tags: [REST API, Test Code, ddokso, ]
categories: [í”„ë¡œì íŠ¸, ë˜‘ì†Œ, ]
mermaid: true
---


> ğŸ’¡ Nestjs í™˜ê²½ì—ì„œ REST API ìŠ¤í‚¤ë§ˆ ê²€ì¦ì„ íš¨ìœ¨ì ìœ¼ë¡œ í•˜ê¸° ìœ„í•œ ì „ëµì„ ì†Œê°œí•©ë‹ˆë‹¤.


êµ¬í˜„ëœ ì „ëµ ë„ì‹ì…ë‹ˆë‹¤.


![0](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/0.png)



### 1. ë°°ê²½ ì„¤ëª…


ë˜‘ì†Œ ë°±ì—”ë“œëŠ” REST APIë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì— ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. 


![1](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/1.png)


ìì›ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” REST APIëŠ” ë°±ì—”ë“œì—ì„œ íš¨ìœ¨ì ì¼ ìˆ˜ ìˆì§€ë§Œ íŠ¹ì • ìš”êµ¬ì‚¬í•­ì„ í•´ê²°í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ìˆê¸°ë„ í•©ë‹ˆë‹¤. ëŒ€í‘œì ìœ¼ë¡œ ëœë”© í˜ì´ì§€, ì´ë²¤íŠ¸ì„± ë§ˆì¼€íŒ… í˜ì´ì§€ê°€ ê·¸ëŸ¬í•©ë‹ˆë‹¤. 


ì´ëŸ¬í•œ UI ì¢…ì†ë˜ëŠ” íŠ¹ì„±ì„ ê°€ì§„ ë°ì´í„°ë¥¼ ì „ì‹œì„± ë°ì´í„°ë¼ê³  ë§í•©ë‹ˆë‹¤. ê¸°ì¡´ ë˜‘ì†Œì—ë„ â€œë©”ì¸ ëœë”© í˜ì´ì§€â€, â€œë¸Œëœë“œê´€ ëœë”© í˜ì´ì§€â€ê°€ ì „ì‹œì„± ë°ì´í„°ë¥¼ ê°€ì§‘ë‹ˆë‹¤.


ê·¸ë¦¬ê³  ì „ì‹œì„± ë°ì´í„°ëŠ” ê¸°ì¡´ REST APIë¡œ ì œê³µí•˜ê¸° ê¹Œë‹¤ë¡­ê³  ë³µì¡ì„±ì„ ì˜¬ë¦°ë‹¤ê³  íŒë‹¨ë˜ì–´ `landings API`ë¡œ ë”°ë¡œ ì •ì˜í•´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì œê³µí•˜ê¸°ë¡œ í•©ë‹ˆë‹¤.


![2](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/2.png)


ì´ëŸ¬í•œ ìƒí™©ì— ì´ë²ˆì— ë˜‘ì†Œ 2.0ì„ ì§„í–‰í•˜ë©°, ëª‡ê°€ì§€ ëœë”© í˜ì´ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.


![3](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/3.png)


ê·¸ë¦¬ê³  ë¶ˆí¸í•œ ì ì´ ë°œìƒí•©ë‹ˆë‹¤. 


ì´ë²ˆì— ì¶”ê°€ëœ API ê¸°ì¡´ ì „ì‹œì„± ë°ì´í„°ì— ë¹„í•´ `response`ì˜ í¬ê¸°ê°€ ëª‡ ë°°ëŠ” ì»¸ìŠµë‹ˆë‹¤. ë•Œë¬¸ì— ë°ì´í„°ì— ë¬¸ì œê°€ ë°œìƒ í–ˆì„ë•Œ ì§ê´€ì ìœ¼ë¡œ ì–´ë–¤ ê³³ì— ë¬¸ì œê°€ ìˆëŠ”ì§€ íŒŒì•…í•˜ê¸°ê°€ ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.


ìƒí™©ì—ì„œ í”„ë¡ íŠ¸ ê°œë°œì ë¶„ê»˜ ë°ì´í„°ì— ë¬¸ì œê°€ ìˆë‹¤ëŠ” ë©”ì‹œì§€ê°€ ì˜¤ê²Œë©ë‹ˆë‹¤.


![4](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/4.png)


ì²˜ìŒì€ `response`ë¥¼ ì²´í¬í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ ë¬¸ì œë¥¼ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ë¥¼ ë„ì…í•˜ê¸°ë¡œ í•©ë‹ˆë‹¤.



### 2. í…ŒìŠ¤íŠ¸ ë„ì… - Jestë¥¼ ì‚¬ìš©í•œ ì‹¬í”Œí•œ êµ¬í˜„ ë°©ì‹


ì²˜ìŒì€ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ”ê²Œ ë¨¼ì € ì˜€ê¸°ì— ê°€ì¥ ë‹¨ìˆœí•œ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.

- ê²€ì¦ì€ `TestingModule`ê³¼ `supertest`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.


{% raw %}
```typescript
describe('LandingController (e2e) - Response Validation', () => {
  let app: INestApplication;

  beforeAll(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    app.setGlobalPrefix('/api');
    await app.init();
  });

  afterAll(async () => {
    await app.close();
  });

  describe('/api/landings/brand-hall (GET)', () => {
    it('ìŠ¤ì›¨ê±° ìŠ¤í™ì— ë§ëŠ” ì‘ë‹µ êµ¬ì¡° ë° í•„ë“œ ê²€ì¦', async () => {
      const res = await request(app.getHttpServer())
        .get('/api/landings/brand-hall')
        .expect(200);
			
			// ê¸°ë³¸ ì‘ë‹µ í¬ë©§ ê²€ì¦
			validateDefaultResponse(res)

      const data = res.body.data;
      // í•„ìˆ˜ í•„ë“œ ë° íƒ€ì… ê²€ì¦
      expect(data).toHaveProperty('brands');
      expect(Array.isArray(data.brands)).toBe(true);
      expect(data).toHaveProperty('brandHallProductRanks');
      expect(Array.isArray(data.brandHallProductRanks)).toBe(true);
      expect(data).toHaveProperty('brandHallSections');
      expect(Array.isArray(data.brandHallSections)).toBe(true);

      // brands ë°°ì—´ ìš”ì†Œ êµ¬ì¡° ê²€ì¦
      if (data.brands.length > 0) {
        const brand = data.brands[0];
				// ... ìƒëµ
      }

      // brandHallProductRanks ë°°ì—´ ìš”ì†Œ êµ¬ì¡° ê²€ì¦
      if (data.brandHallProductRanks.length > 0) {
        const rank = data.brandHallProductRanks[0];
				// ... ìƒëµ
      }

      // brandHallSections ë°°ì—´ ìš”ì†Œ êµ¬ì¡° ë° ê° ì„¹ì…˜ ë‚´ ìƒí’ˆ ê²€ì¦
      if (data.brandHallSections.length > 0) {
        data.brandHallSections.forEach((section: any) => {
          expect(section).toHaveProperty('brand');
          expect(section).toHaveProperty('products');
          expect(Array.isArray(section.products)).toBe(true);

          // ê° ì„¹ì…˜ì˜ ìƒí’ˆ ê²€ì¦
          section.products.forEach((product: any) => {
            validateGetProductsResponse(product);
          });
        });
      }
    });
  });
});
```
{% endraw %}




### 3. í…ŒìŠ¤íŠ¸ ê°œì„ ì„ ìœ„í•œ ìš”êµ¬ì‚¬í•­ ì •ë¦¬



#### 3.1. ë¬¸ì œ ìƒí™© ì •ì˜


ìœ„ì˜ ë°©ë²•ì€ ë‹¹ì¥ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸°ì— ì í•©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì§€ì†í•´ì„œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” ë¬¸ì œê°€ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

1. ë¬¸ìì—´ í•˜ë“œì½”ë”© ë¬¸ì œ

	`jest#toHaveProperty`ì— ì¸ìë¡œ ì œê³µë˜ëŠ” ê°’ì€ ë‹¨ìˆœí•œ ë¬¸ìì—´ ì…ë‹ˆë‹¤. ë‹¨ìˆœ ë¬¸ìì—´ì€ ì–¸ì œë‚˜ íœ´ë¨¼ì—ëŸ¬ê°€ ë°œìƒí•˜ê¸° ë„ˆë¬´ë‚˜ ì‰½ìŠµë‹ˆë‹¤.

2. íƒ€ì… ì¶”ë¡  ë¬¸ì œ

	`supertest`ë¿ ì•„ë‹ˆë¼ ëª¨ë“  HTTP í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” íƒ€ì… ì¶”ë¡ ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ë•Œë¬¸ì— `data.brands`ë¥¼ `data.brand`ë¡œ ì ‘ê·¼í•´ë„ tsì™€ lintì—ê²Œ ì–´ë– í•œ ë„ì›€ë„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

	- íƒ€ì…ê°€ë“œë¥¼ ì‚¬ìš©í•´ ì–´ëŠ ì •ë„ í•´ê²°ì€ ê°€ëŠ¥í•˜ì§€ë§Œ ê·¸ ë˜í•œ ì™„ë²½í•œ í•´ê²°ì±…ì€ ë˜ì§€ ëª»í•©ë‹ˆë‹¤.
3. ìœ ì§€ë³´ìˆ˜ì˜ í”¼ë¡œë„

	REST API ìŠ¤í™ì´ ë³€ê²½ë  ë•Œ ë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤í™ì´ ë³€ê²½ë˜ì—ˆìœ¼ë‹ˆ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ”ê²Œ ë§ì§€ ì•ŠëŠ”ê°€ ì˜ë¬¸ì´ ë“¤ ìˆ˜ ìˆì§€ë§Œ ì†Œê·œëª¨ ì¸ì›ìœ¼ë¡œ í”„ë¡œì íŠ¸ë¥¼ ìš´ì˜í•˜ëŠ” ê°œë°œ ì¡°ì§ì—ì„œëŠ” ìœ ì§€í•˜ê¸° ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤.



#### 3.2. ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ìš”êµ¬ì‚¬í•­


ë¨¼ì € ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ìš”êµ¬ì‚¬í•­ì„ ì •ì˜í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.

1. ë¬¸ìì—´ í•˜ë“œì½”ë”©ì„ ì‚¬ìš©í•˜ì§€ ë§ì•„ì•¼ í•œë‹¤.
2. íƒ€ì… ì¶”ë¡ ì´ ê°€ëŠ¥í•´ì•¼í•œë‹¤.
3. ìœ ì§€ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ê´€ë¦¬í•˜ê¸° í¸ë¦¬í•´ì•¼ í•œë‹¤.

ë¨¼ì € `jest`ì—ì„œ ì œê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ëŠ” ì¢‹ì€ íˆ´ì´ì§€ë§Œ í˜„ì¬ ìƒí™©ì—ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. 
ì´ëŸ¬í•œ ì´ìœ ë¡œ ë‹¤ì–‘í•œ ìŠ¤í‚¤ë§ˆ ê²€ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¡°ì‚¬í•©ë‹ˆë‹¤.



#### **3.3. ì£¼ìš” í›„ë³´ ë° ë¹„êµ**


| **ë¼ì´ë¸ŒëŸ¬ë¦¬** | **TypeScript í†µí•©** | **NestJS ì—°ë™** | **íƒ€ì… ì¶”ë¡ ** | **E2E í…ŒìŠ¤íŠ¸ ì í•©ì„±** | **íŠ¹ì§•/ë¹„ê³ **             |
| --------- | ----------------- | ------------- | --------- | --------------- | --------------------- |
| `Zod`     | ë§¤ìš° ìš°ìˆ˜             | ê³µì‹ ì§€ì›         | ìë™ ì¶”ë¡      | ë§¤ìš° ìš°ìˆ˜           | TS-first, ê²½ëŸ‰, ì‰¬ìš´ ë¬¸ë²•   |
| `Joi`     | ë³´í†µ                | ê³µì‹ ì§€ì›         | ì œí•œì        | ìš°ìˆ˜              | ì„±ìˆ™, ë‹¤ì–‘í•œ ê¸°ëŠ¥, íƒ€ì…ì€ ì•½í•¨    |
| `AJV`     | ë‚®ìŒ                | ë¯¸ì§€ì›           | ë³„ë„ ë„êµ¬     | ë³´í†µ              | JSON Schema, íƒ€ì… ì¶”ë¡  ì•½í•¨ |
| `Yup`     | ë³´í†µ                | ë¯¸ì§€ì›           | ì œí•œì        | ë³´í†µ              | í”„ë¡ íŠ¸ì—”ë“œ í¼ì— íŠ¹í™”           |

undefined
ê·¸ë¦¬ê³  í¸ì˜ë¥¼ í•œ ê°€ì§€ ìš”êµ¬ì‚¬í•­ì„ ì¶”ê°€ë¡œ ì¡°ì‚¬í•©ë‹ˆë‹¤.


> **`Swagger generator`** **ì²˜ëŸ¼ Swagger ë¬¸ì„œë¥¼ í†µí•œ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±**


ì´ì „ ê°œë°œ ì¡°ì§ì—ì„œ `Swagger generator`ë¥¼ í†µí•´ SDKë¥¼ í”„ë¡ íŠ¸íŒ€ì— ì œê³µí•œ ì ì´ ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹œ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆëŠ”ì§€ í™•ì¸í–ˆê³  ê²°ê³¼ì ìœ¼ë¡œ `openapi-zod-client` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ê²Œ ë©ë‹ˆë‹¤.



#### 3.4. ìµœì¢… ê²°ì •


![5](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/5.png)


`swagger.json`ê³¼ `openapi-zod-client`ë¥¼ í†µí•´ `zod` ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸ì— ì ìš©í•˜ê¸°ë¡œ í•©ë‹ˆë‹¤.



### 4. í…ŒìŠ¤íŠ¸ ê°œì„  - zod ìŠ¤í‚¤ë§ˆë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸ë¡œ ë³€ê²½



#### 4.1. Swagger.json ìƒì„±


ë¨¼ì € `swagger.json`ì„ ìƒì„±í•©ë‹ˆë‹¤.


`@nestjs/swagger` ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ `swagger.json` ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ 2ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

1. ì„œë²„ ì‹¤í–‰ í›„ Swagger UI ê²½ë¡œì— `-json`ì„ ë¶™ì—¬ì„œ êµ¬í•œë‹¤.
	- ì°¸ê³ : [ê³µì‹ë¬¸ì„œ](https://docs.nestjs.com/openapi/introduction#bootstrap)
2. `@nestjs/swagger#SwaggerModule.createDocument` ê²°ê³¼ë¥¼ json íŒŒì¼ë¡œ ìƒì„±í•œë‹¤.

**ë‘ ë²ˆì§¸ ë°©ë²•ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.**



{% raw %}
```typescript
// 1. Nestjs Test ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ AppModule ìƒì„±
const moduleRef = await Test.createTestingModule({
  imports: [AppModule],
}).compile();

// 2. Nestjs app ìƒì„±
const app = moduleRef.createNestApplication();
app.setGlobalPrefix('/api');
  
// 3. Swagger Document ìƒì„±
const documentBuilder = new DocumentBuilder()
  .setTitle(title)
  .setDescription(description)
  .addBearerAuth(securityOptions, name)
  .setVersion(version);
const swaggerConfig = documentBuilder.build();
const document = SwaggerModule.createDocument(app, swaggerConfig);

// 4. ìƒì„±ëœ documentë¥¼ json íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
const jsonPath = path.join(process.cwd(), 'swagger.json');
fs.writeFileSync(jsonPath, JSON.stringify(document, null, 2));
```
{% endraw %}




#### 4.2. Zod ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±


ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±ì€ `openapi-zod-client` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.


`openapi-zod-client`ëŠ” `npx`ë¥¼ í†µí•´ ì„¤ì¹˜ í•˜ì§€ ì•Šê³  ì¦‰ì‹œ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. 



{% raw %}
```bash
$ npx openapi-zod-client swagger.json -o zod-schema.ts
```
{% endraw %}



**ìƒì„±ëœ** **`zod-schema.ts`** **í™•ì¸**



{% raw %}
```typescript
import { makeApi, Zodios, type ZodiosOptions } from '@zodios/core';
import { z } from 'zod';

const GetProductsResponse = z
  .object({
    id: z.string().default('1'),
    groupId: z.string().default('1'),
    originId: z.string().default('1'),
    title: z.string().max(225).default('ìƒí’ˆëª…'),
    imageUrl: z.string().max(1000).default('ì´ë¯¸ì§€ URL'),
    subTitle: z.string().max(225).nullish().default('ì˜µì…˜ëª…'),
    weightInfo: z.string().max(225).nullish().default('ì¤‘ëŸ‰ë‹¹í‘œì‹œì •ë³´'),
    deliveryImageUrl: z.string().max(255).nullish().default(''),
    quantityInfo: z.string().max(255).nullish().default(''),
    volumeInfo: z.string().max(255).nullish().default(''),
    isStock: z.boolean().default(false),
    notiCount: z.number().gte(0).default(0),
    tags: z.array(GetProductsWithTagsResponse),
    price: GetProductsWithPriceResponse,
  })
  .passthrough();
  
const GetMainResponse = z
  .object({
    categories: z.array(GetCategoriesResponse),
    todayLowestProducts: z.array(GetProductsResponse).max(30),
    tomorrowLowestProducts: z.array(GetProductsResponse).max(30),
    manwonHappinessFoodProducts: z.array(GetProductsResponse),
    manwonHappinessLifeProducts: z.array(GetProductsResponse),
  })
  .passthrough();
// ... ìƒëµ
```
{% endraw %}




#### 4.3. ìƒì„±ëœ zod ìŠ¤í‚¤ë§ˆ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ì ìš©


ê¸°ì¡´ `LandingController` í…ŒìŠ¤íŠ¸ì— ìƒì„±ëœ `zod-schema.ts`ë¥¼ ì ìš©í•œë‹¤.



{% raw %}
```typescript
import { schemas } from '../util/zod-schema';

describe('LandingController (e2e) - Response Validation', () => {
  let app: INestApplication;

  beforeAll(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    app.setGlobalPrefix('/api');
    await app.init();
  });

  afterAll(async () => {
    await app.close();
  });

  // /api/landings/brand-hall (GET)
  describe('/api/landings/brand-hall (GET)', () => {
    it('ìŠ¤ì›¨ê±° ìŠ¤í™ì— ë§ëŠ” ì‘ë‹µ êµ¬ì¡° ë° í•„ë“œ ê²€ì¦', async () => {
      // ìš”ì²­
      const res = await request(app.getHttpServer())
        .get('/api/landings/brand-hall')
        .expect(200);

      // ê¸°ë³¸ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ê²€ì¦
      validateDefaultResponse(res);

      // zodë¥¼ ì‚¬ìš©í•´ ì‘ë‹µ ë°ì´í„° ìŠ¤í‚¤ë§ˆ ê²€ì¦
      const data = res.body.data;
      schemas.GetBrandHallResponse.parse(data);
    });
  });
});
```
{% endraw %}



**í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ í™•ì¸**


ì„±ê³µ ì¼€ì´ìŠ¤


![6](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/6.png)


ì‹¤íŒ¨ ì¼€ì´ìŠ¤


![7](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/7.png)



### 5. í…ŒìŠ¤íŠ¸ ì¶”ê°€ ê°œì„  - zod ìŠ¤í‚¤ë§ˆ ìƒì„± ìë™í™”


> ğŸ“Œ ì €ëŠ” ìë™í™”(ë”¸ê¹)ì— ê´€ì‹¬ì´ ë§ìŠµë‹ˆë‹¤. ìœ„ì˜ ê°œì„ ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìì²´ì˜ ì•ˆì •ì„±ì€ ì˜¬ë¼ê°”ì§€ë§Œ ì—¬ì „íˆ zod ìŠ¤í‚¤ë§ˆ ìµœì‹ í™”ëŠ” ìˆ˜ë™ìœ¼ë¡œ í•´ì•¼í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³¼ì • ë˜í•œ ìë™í™” í•˜ê¸°ë¡œ í•©ë‹ˆë‹¤.



#### 5.1. zod ìŠ¤í‚¤ë§ˆ ìƒì„± ìë™í™” í…ŒìŠ¤íŠ¸ ì „ëµ


![8](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/8.png)


JestëŠ” í…ŒìŠ¤íŠ¸ ì‚¬ì´í´ì—ì„œ ëª‡ ê°€ì§€ ì»¤ìŠ¤í…€ ê°€ëŠ¥í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. 


| **ì˜µì…˜**               | **ì‹¤í–‰ ì‹œì **       | **"í•œ ë²ˆë§Œ ì‹¤í–‰"ì— ì í•©?** |
| -------------------- | --------------- | ------------------ |
| `globalSetup`        | í…ŒìŠ¤íŠ¸ ì „ì²´ ì‹œì‘ ì „ 1íšŒ  | **O (ì í•©)**         |
| `setupFilesAfterEnv` | ê° í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‹¤í–‰ ì „ë§ˆë‹¤ | X (ë¶€ì í•©)            |
| `globalTeardown`     | í…ŒìŠ¤íŠ¸ ì „ì²´ ì¢…ë£Œ í›„ 1íšŒ  | **O (ì¢…ë£Œ/ì •ë¦¬ìš©)**     |

undefined- ì„¤ì •ì€ `jest.json` íŒŒì¼ì„ í†µí•´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- `globalSetup`ì„ í™œìš©í•©ë‹ˆë‹¤.


#### 5.2. `globalSetup` ì‹œì ì— zod ìŠ¤í‚¤ë§ˆë¥¼ ìµœì‹ í™”ë¥¼ ìœ„í•œ ì„¤ì • - âŒÂ ì‹¤íŒ¨


`globalSetup`ì— ì ìš©ë  ì½”ë“œ ì…ë‹ˆë‹¤. 


ì•„ì‰½ê²Œë„ ë˜‘ì†Œ í”„ë¡œì íŠ¸ì˜ ê²½ìš° **ì•„ë˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì§€ ëª»í•©ë‹ˆë‹¤.**



{% raw %}
```typescript
/**
 * 1. AppModule ìƒì„±
 * 2. @nestjs/swaggerë¡œ swagger.json ìƒì„±
 * 3. npx openapi-zod-client swagger.json -o zod-schema.tsë¡œ zod ìŠ¤í‚¤ë§ˆ ìƒì„±
 */
export default async function () {
  const moduleRef = await Test.createTestingModule({
    imports: [AppModule],
  }).compile();

  const app = moduleRef.createNestApplication();
  app.setGlobalPrefix('/api');

  // swagger.json ìƒì„± í•¨ìˆ˜
  buildSwagger(app, {
    docsPath: '/docs',
    useSwaggerJson: true,
    modules: [LandingModule], // í˜„ì¬ëŠ” landingë§Œ ì‚¬ìš©
  });

  // openapi-zod-clientì„ ì‚¬ìš©í•´ swagger.jsonì„ ì‚¬ìš©í•´ zod ìŠ¤í‚¤ë§ˆ ìƒì„±
  try {
    const outSchemaPath = 'test/e2e/util/zod-schema.ts';
    exec(`npx openapi-zod-client swagger.json -o ${outSchemaPath}`);
  } catch (error) {
    console.error(error);
    throw error;
  }
}
```
{% endraw %}



ì´ìœ ëŠ” typescript ìƒëŒ€ê²½ë¡œ ë•Œë¬¸ì…ë‹ˆë‹¤. ë˜‘ì†Œ API í”„ë¡œì íŠ¸ëŠ” ì´ˆê¸°ë¶€í„° ìƒëŒ€ê²½ë¡œë¥¼ ì ê·¹ ì´ìš©í–ˆìŠµë‹ˆë‹¤.


ì•„ë˜ëŠ” `tsconfig.json`ì— ì„¤ì •ëœ ìƒëŒ€ê²½ë¡œì…ë‹ˆë‹¤.



{% raw %}
```typescript
"paths": {
  "@app/common": [
    "src/common"
  ],
  "@app/common/*": [
    "src/common/*"
  ],
  "@app/config": [
    "src/config"
  ],
  ...
}
```
{% endraw %}



ë¬¼ë¡  Jestë„ ì„¤ì •íŒŒì¼ì„ í†µí•´ ìƒëŒ€ê²½ë¡œ ì§€ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.


í•˜ì§€ë§Œ **ì •ì±…ìƒì˜ ì´ìœ ë¡œ** **`globalSetup`** **ì‹œì ì—ì„œëŠ” ìƒëŒ€ê²½ë¡œ ì„¤ì •ì´ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**



#### 5.4. `globalSetup` ì‹œì ì— zod ìŠ¤í‚¤ë§ˆë¥¼ ìµœì‹ í™”ë¥¼ ìœ„í•œ ì„¤ì • - âœ…Â ì„±ê³µ


> ğŸ’¡ ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?   
> ë‹¤ì–‘í•œ í•´ê²° ë°©ë²•ì´ ìˆê² ì§€ë§Œ ì €ëŠ” `npm scripts` ëª…ë ¹ì„ ì‚¬ìš©í•˜ê¸°ë¡œ í•©ë‹ˆë‹¤.


**5.4.1.** **`generate-zod-schema.ts`** **íŒŒì¼ ì •ì˜**



{% raw %}
```typescript
(async () => {
  await generateZodSchema();
  process.exit(0);
})();

/**
 * 1. AppModule ìƒì„±
 * 2. @nestjs/swaggerë¡œ swagger.json ìƒì„±
 * 3. npx openapi-zod-client swagger.json -o generated-schema.tsë¡œ zod ìŠ¤í‚¤ë§ˆ ìƒì„±
 */
export async function generateZodSchema() {
  const moduleRef = await Test.createTestingModule({
    imports: [AppModule],
  }).compile();

  const app = moduleRef.createNestApplication();
  app.setGlobalPrefix('/api');

  // swagger.json ìƒì„±
  buildSwagger(app, {
    docsPath: '/docs',
    useSwaggerJson: true,
    modules: [LandingModule], // í˜„ì¬ëŠ” landingë§Œ ì‚¬ìš©
  });

  // openapi-zod-clientì„ ì‚¬ìš©í•´ swagger.jsonì„ ì‚¬ìš©í•´ zod ìŠ¤í‚¤ë§ˆ ìƒì„±
  try {
    const outSchemaPath = 'test/e2e/util/zod-schema.ts';
    exec(`npx openapi-zod-client swagger.json -o ${outSchemaPath}`);
  } catch (error) {
    console.error(error);
    throw error;
  }
}
```
{% endraw %}



**5.4.2.** **`package.json`****ì— ì‹ ê·œ scripts** **`pre:e2e`** **ëª…ë ¹ ì¶”ê°€**



{% raw %}
```typescript
"scripts": {
	"pre:e2e": "ts-node -r tsconfig-paths/register -- test/e2e/pre/generate-zod-schema.ts",
}
```
{% endraw %}



**5.4.3.** **`globalSetup`****ì—ì„œ ì‹ ê·œ ì •ì˜í•œ** **`pre:e2e`** **ëª…ë ¹ ì‹¤í–‰**



{% raw %}
```typescript
/**
 * 1. AppModule ìƒì„±
 * 2. @nestjs/swaggerë¡œ swagger.json ìƒì„±
 * 3. npx openapi-zod-client swagger.json -o generated-schema.tsë¡œ zod ìŠ¤í‚¤ë§ˆ ìƒì„±
 */
export default async function () {
  try {
    console.log(`\nğŸ” Jest E2E Global setup started`);

    console.log('â³ Generating zod schema...');
    // ëª…ë ¹ ì‹¤í–‰
    exec('npm run pre:e2e');
    console.log('âœ… Zod schema generated successfully \n');
  } catch (error) {
    console.error(error);
    throw error;
  }
}
```
{% endraw %}




#### 5.5. ìµœì¢… ì‹¤í–‰ ê²°ê³¼ í™•ì¸


![9](/assets/img/2025-05-10-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-REST-API-ì‘ë‹µ-ìŠ¤í‚¤ë§ˆ-í…ŒìŠ¤íŠ¸-ì „ëµ.md/9.png)


ì´ì œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ë§ˆë‹¤

1. nestjsì— ì •ì˜ëœ ì½”ë“œ ê¸°ë°˜ìœ¼ë¡œ `swagger.json` ìƒì„±
2. ìƒì„±ëœ swagger.jsonì„ ê¸°ë°˜ìœ¼ë¡œ zod ìŠ¤í‚¤ë§ˆê°€ ìƒì„±
3. ë§ˆì§€ë§‰ìœ¼ë¡œ zod ìŠ¤í‚¤ë§ˆë¥¼ ì‚¬ìš©í•´ API ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.


### 6. ì •ë¦¬


ì´ë²ˆ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸ ìë™í™” ê³¼ì •ì€ ê¸°ëŠ¥ êµ¬í˜„ì´ë‚˜ ìš”êµ¬ì‚¬í•­ì„ ìœ„í•œ ê°œì„  ì‘ì—…ì€ ì•„ë‹ˆì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í•„ìš”í•œ ì‘ì—…ì´ì˜€ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. 


ë” ë‚˜ì•„ê°€ ì´ëŸ¬í•œ Swaggerë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” í…ŒìŠ¤íŠ¸ êµ¬ì¶•ì€ í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œ ì‚¬ì´ì— ì•ˆì •ì„±ê³¼ ì‹ ë¢°ë¥¼ ìœ„í•´ì„œ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ë‹¤ë§Œ ëª¨ë“  ê¸°ëŠ¥ì€ í•„ìš”í•œ ì‹œì ì´ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. 


ì´ì´.. 

