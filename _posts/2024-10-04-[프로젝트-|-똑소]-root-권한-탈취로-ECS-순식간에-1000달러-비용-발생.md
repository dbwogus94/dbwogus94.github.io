---
layout: post
date: 2024-10-04
title: "[í”„ë¡œì íŠ¸ | ë˜‘ì†Œ] root ê¶Œí•œ íƒˆì·¨ë¡œ ECS ìˆœì‹ê°„ì— 1000ë‹¬ëŸ¬ ë¹„ìš© ë°œìƒ"
categories: [í”„ë¡œì íŠ¸, ë˜‘ì†Œ, ]
mermaid: true
---



### 1. ì¦ìƒ ì •ë¦¬


> ğŸ’¡ 24-10-06ì— ë¹„ìš© ê²½ë³´ ë©”ì¼ì´ ë‚ ë¼ ì™”ë‹¤. ìƒí™©ì„ ë³´ë‹ˆ ì´ë¯¸ì§€ ì²˜ëŸ¼ 1000ë‹¬ëŸ¬ì˜ ë¹„ìš©ì´ ë°œìƒí–ˆì§€ë§Œ AWSì—ì„œ ì¦‰ì‹œ ë¹„í™œì„±í™” í•´ì¤€ ìƒíƒœì˜€ë‹¤.



#### 1.1. AWS Support ì½˜ì†” í™•ì¸


![0](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/0.png)



#### 1.2. 1000ë‹¬ëŸ¬ ë¹„ìš© ë°œìƒì„ í™•ì¸í–ˆë‹¤.


![1](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/1.png)



#### 1.3. ëª¨ë“  ë¦¬ì „ì˜ ECS í´ëŸ¬ìŠ¤í„°ê°€ 20ê°œ ì´ìƒ ìƒì„±ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸

- `us-east-1` ë¦¬ì „ í´ëŸ¬ìŠ¤í„° ì½˜ì†”

![2](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/2.png)

- `us-east-1` ë¦¬ì „ í…ŒìŠ¤í¬ ì½˜ì†”

![3](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/3.png)

- í…ŒìŠ¤í¬ í™•ì¸ - 16 ì½”ì–´, 32GB ë¨ìœ¼ë¡œ ì„¤ì •

![4](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/4.png)



#### 1.4. ìƒì„±ì„ ì–¸ì œ ëˆ„êµ¬ ê¶Œí•œìœ¼ë¡œ í–ˆëŠ”ì§€ í™•ì¸


![5](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/5.png)


â‡’  root ê³„ì •ìœ¼ë¡œ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  `arn:aws:sts::xxxxxxx:assumed-role/AWSReservedSSO_AdministratorAccess_176dbd0533c81274/root`



### 2. ì¡°ì¹˜ ê³¼ì • - 1ì°¨


> ğŸ“Œ root ê³„ì •ì´ í„¸ë¦° ì´ìœ ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤. ë‹¤ë§Œ root ê³„ì •ì˜ ê²½ìš° í”„ë¡œì íŠ¸ë¥¼ ì²˜ìŒ ê¸°íší•œ í—¤ë“œê°€ ê°€ì§€ê³  ìˆì—ˆê³  2ì°¨ ì¸ì¦ì´ ì•ˆ ë˜ì–´ ìˆëŠ” ìƒíƒœì˜€ë‹¤.

1. ë¯¸í™•ì¸ IAM ì •ë¦¬ ë° ëª¨ë“  ê³„ì • ì„ì‹œ ì°¨ë‹¨ ë° ëª¨ë“  ê³„ì • password ë³€ê²½ 2ì°¨ ì¸ì¦ ê°•ì œ ì„¤ì •
undefined<details>
  <summary>**ì ê¹ ë°˜ì„±ì˜ ì‹œê°„! ê°€ì¥ ë°˜ì„±í•  ì ì€ 2ì°¨ ì¸ì¦ì„ ê°•ì œí•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì ì´ë‹¤..ğŸ¥²**</summary>


ê°œì¸ í”„ë¡œì íŠ¸ë‚˜ ê°€ë³ê²Œ íŒ€ì›ì„ ê¾¸ë ¤ì„œ í”„ë¡œì íŠ¸ë¥¼ í•˜ëŠ” ê²½ìš° ê¶Œí•œê³¼ AWSì— ëŒ€í•œ 2ì°¨ ì¸ì¦ì„ í•­ìƒ ê°•ì œ í–ˆì—ˆë‹¤. ì´ë²ˆì—ëŠ” ì´ˆê¸° AWS ì„¤ì •ì„ ë‹¤ë¥¸ ë¶„ì´ í–ˆë˜ ê²ƒì„ ë„˜ê²¨ ë°›ì€ ìƒí™©ì´ ì˜€ê³ , ë” ì†”ì§í•˜ê²ŒëŠ” ì•ˆì¼ í–ˆë‹¤. 


í”„ë¡œì íŠ¸ë¥¼ ë¹¨ë¦¬ ë§Œë“œëŠ” ê²ƒì—ë§Œ ì§‘ì¤‘í–ˆê³  ì„¸ì„¸í•œ ê²ƒì€ ë‚˜ì¤‘ì¼ë¡œ ì¹˜ë¶€í–ˆê¸° ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ ë¬¸ì œëŠ” í•­ìƒ ë°©ì‹¬í• ë•Œ í„°ì§€ë“¯ í•´í‚¹ ì‚¬ê±´ìœ¼ë¡œ ë‹¤ì‹œ í•œ ë²ˆ ê²½ê°ì‹¬ì„ ê°€ì§€ëŠ” ê¸°íšŒê°€ ë˜ì—ˆë‹¤.


ì—¬ë‹´ìœ¼ë¡œ ë¹„ìŠ·í•œ ì‹œê¸°ì— íŒ€ì›ë¶„ì´ ì œì§í•˜ëŠ” íšŒì‚¬ì—ì„œ ìœ ì‚¬í•œ í•´í‚¹ì„ ë‹¹í–ˆê³ , ì´ ê²½í—˜ ë•ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆì—ˆë‹¤.



  </details>2. í•´í‚¹ë²”ì´ ë§Œë“  root ê³„ì • ì •ì§€

	![6](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/6.png)


	fdefsê°€ í•´í‚¹ë²”ì´ ë§Œë“  root ê³„ì •ì´ë‹¤. ì‚­ì œëŠ” ì‹ ìš©ì¹´ë“œ ë“±ë¡ì´ ì—†ìœ¼ë©´ ë¶ˆê°€í•˜ë‹¤ê³  í•´ì„œ ì´í›„ AWS ì¸¡ì—ì„œ ì œê±°ë¥¼ í•´ì£¼ì—ˆë‹¤.

3. ECS Taskê³¼ í´ëŸ¬ìŠ¤í„° ì œê±°ë¥¼ ìœ„í•œ AWS CLIë¥¼ ì‚¬ìš©í•œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ëŒë¦¬ê¸°


{% raw %}
```bash
#!/bin/bash

# ì„¤ì •
AWS_PROFILE="ddokso"

# vimì´ ì—´ë¦¬ëŠ” ê²ƒì„ ë°©ì§€
export EDITOR=:
export VISUAL=:

regions=$(aws ec2 describe-regions --all-regions --query 'Regions[].RegionName' --output text --profile "$AWS_PROFILE")

for region in $regions 
do
    echo "Processing region: $region"
    
    # INACTIVE íƒœìŠ¤í¬ ì •ì˜ ì‚­ì œ
    inactive_task_definitions=$(PAGER='' aws ecs list-task-definitions --status INACTIVE --region $region --query "taskDefinitionArns[]" --output text --profile "$AWS_PROFILE")
    for inactive_task_def in $inactive_task_definitions; do
        echo "Deleting inactive task definition: $inactive_task_def"
        PAGER='' aws ecs delete-task-definitions --task-definitions $inactive_task_def --region $region --profile "$AWS_PROFILE"
    done

    # í™œì„± íƒœìŠ¤í¬ ì •ì˜ ë“±ë¡ ì·¨ì†Œ
    task_definitions=$(PAGER='' aws ecs list-task-definitions --region $region --query "taskDefinitionArns[]" --output text --profile "$AWS_PROFILE")
    for task_def in $task_definitions; do
        PAGER='' aws ecs deregister-task-definition --task-definition $task_def --region $region --profile "$AWS_PROFILE"
    done
    
    # í´ëŸ¬ìŠ¤í„° ë° ì„œë¹„ìŠ¤ ì‚­ì œ
    clusters=$(PAGER='' aws ecs list-clusters --region $region --query "clusterArns[]" --output text --profile "$AWS_PROFILE")
    for cluster in $clusters; do
        services=$(PAGER='' aws ecs list-services --cluster $cluster --region $region --query "serviceArns[]" --output text --profile "$AWS_PROFILE")
        for service in $services; do
            PAGER='' aws ecs update-service --cluster $cluster --service $service --desired-count 0 --region $region --profile "$AWS_PROFILE"
            PAGER='' aws ecs delete-service --cluster $cluster --service $service --force --region $region --profile "$AWS_PROFILE"
        done
        
        # ì‹¤í–‰ ì¤‘ì¸ íƒœìŠ¤í¬ ì¤‘ì§€
        tasks=$(PAGER='' aws ecs list-tasks --cluster $cluster --region $region --query "taskArns[]" --output text --profile "$AWS_PROFILE")
        for task in $tasks; do
            PAGER='' aws ecs stop-task --cluster $cluster --task $task --region $region --profile "$AWS_PROFILE"
        done
        
        PAGER='' aws ecs delete-cluster --cluster $cluster --region $region --profile "$AWS_PROFILE"
    done
done
```
{% endraw %}




### 3. AWS ì—ì„œ ì¶”ê°€ë¡œ í™•ì¸ëœ ë¬¸ì œì ì´ ìˆë‹¤ê³  ì—°ë½ì´ ì™”ë‹¤.


> ğŸ“Œ AWS ì¸¡ì—ì„œ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ë¦¬ì „ì—ë„ ECS í´ëŸ¬ìŠ¤í„°ê°€ ìƒì„±ë˜ì–´ ìˆë‹¤ê³  ì—°ë½ì´ ì™”ë‹¤. (Cape Town, Hong Kong, Bahrain, UAE, Hyderabad, Spain, Melbourne, Milan, Jakarta, Zurich ë¦¬ì „ í™•ì¸ ìš”ì²­)

<details>
  <summary>ì›ë³¸ ë©”ì‹œì§€</summary>


Step 1: Enable the following regions: https://docs.aws.amazon.com/accounts/latest/reference/manage-acct-regions.html#manage-acct-regions-enable-standalone
Cape Town
Hong Kong
Bahrain
UAE
Hyderabad
Spain
Melbourne
Milan
Jakarta
Zurich

*Once you've enabled the regions above, please revisit the ECS console for the regions you've just enabled*

Step 2: Terminate ECS Resources
Clusters:
1. Access the ECS cluster console here: https://us-east-1.console.aws.amazon.com/ecs/home?region=us-east-1#/clusters
2. On the Clusters page, select the cluster to delete.
3. In the upper-right of the page, choose Delete Cluster. You see a confirmation prompt.
4. In the confirmation box, enter delete me. Repeat for all unauthorized clusters.
5. Make sure to check region by region and terminate all those unauthorized.

Task definition:
a) Deregister:
1. Access the ECS console here: https://us-east-1.console.aws.amazon.com/ecs/v2/clusters?region=us-east-1
2. In the region selector navigation bar, choose the Region that contains your task definition.
3. In the navigation pane, choose Task definitions.
4. On the task definitions page, choose the task definition family that contains one or more revisions that you want to deregister.
5. On the task definition Name page, select the box to the left of each task definition revision that you want to deregister.
6. Choose Actions, Deregister.
7. Verify the information in the Deregister task definition window, and then choose Deregister to finish.
8. (Optional) To deregister the task definition family, repeat the above steps for each ACTIVE revision.

b) Delete:
1. Access the ECS console here: https://us-east-1.console.aws.amazon.com/ecs/v2/clusters?region=us-east-1
2. In the navigation pane, choose Task definitions. Click on "Clear Filters" to display the inactive tasks.
3. On the Task definitions page, choose the task definition family that contains one or more revisions that you want to delete.
4. On the task definition Name page, select the revisions to delete, and then choose Actions, Delete.
5. Verify the information in the Delete window, and then choose Delete to finish.

Step 3: Terminate IAM Roles and Policies (Linked to ECS)
1. Access the IAM roles console here: https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles
2. Select the check box next to the role name that you want to delete.
3. At the top of the page, choose Delete.
4. In the confirmation dialog box, review the last accessed information, which shows when each of the selected roles last accessed an AWS service. This to confirm if the role is currently active.
5. If you want to proceed, enter the name of the role in the text input field and choose Delete.
Service linked roles:
1. Access the IAM roles console here: https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles
2. Then choose the name (not the check box) of the service-linked role.
3. On the Summary page for the selected role, choose the Access Advisor tab.
4. On the Access Advisor tab, review recent activity for the service-linked role.
- If the deletion fails because the role is using the service's resources, then the notification includes a list of resources, make sure to delete those resources before attempting to delete the role again.

Please note, unwanted usage can occur in any region and your console only displays one region at a time. To switch regions, use the drop-down menu in the top-right corner of the console. Once you've completed the steps to secure your AWS account, we can proceed to the next step of this process.

If you require assistance with the above, then choose the "Phone" or "Chat" option from the Support Center:



  </details>
ë°”ë ˆì¸ ë¦¬ì „ì— 20ê°œì˜ í´ëŸ¬ìŠ¤í„°ê°€ ì¼œ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ë”ì°í•˜ë‹¤..


![7](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/7.png)



### 4. ì¡°ì¹˜ ê³¼ì • - 2ì°¨ 

1. ë¹„í™œì„± ë¦¬ì „ í™œì„±í™” í›„ 1ì°¨ì—ì„œ ë§Œë“¤ì–´ë‘” **â€œAWS CLIë¥¼ ì‚¬ìš©í•œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸â€**ë¡œ ë‹¤ì‹œ ECS Task ì œê±°
2. `CloudTrail` í™œì„±í™”


#### 4.1. `CloudTrail` ì´ë€?


> ğŸ’¡ AWS CloudTrailì€ AWS ê³„ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì‚¬ìš©ì í™œë™ê³¼ API í˜¸ì¶œì„ ê¸°ë¡í•˜ê³  ì¶”ì í•˜ëŠ” ì„œë¹„ìŠ¤ë¡œ ì£¼ë¡œ â€œ**ë³´ì•ˆ ë° ê°ì‹œ**â€ë¥¼ ìœ„í•´ ì¡´ì¬í•©ë‹ˆë‹¤.


![8](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/8.png)

- í™œì„±í™” í•˜ê²Œ ë˜ë©´ ìŠ¤í¬ë¦°ìƒ· ì²˜ëŸ¼ ì–´ë–¤ ì‚¬ìš©ìê°€ ì–´ë–¤ ìƒí˜¸ì‘ìš©ì„ í•˜ê³  ìˆëŠ”ì§€ ì¶”ì ì´ ê°€ëŠ¥í•˜ë‹¤.
- `CloudTrail`ëŠ”Â â€**90ì¼ ë™ì•ˆì˜ ì´ë²¤íŠ¸ ì¶”ì â€ë§Œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë¬´ë£Œë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.**
	- ì°¸ê³ : [https://aws.amazon.com/ko/cloudtrail/pricing/](https://aws.amazon.com/ko/cloudtrail/pricing/)


### 5. ì¡°ì¹˜ ì´í›„ ìƒí™© ì •ë¦¬


ë¨¼ì € í•´í‚¹ ì‚¬ê±´ ë’¤ë¡œ ë‚´ë¶€ì ì¸ ë…¼ì˜ê°€ ìˆì—ˆë‹¤.

- **íŒ€ ë³´ì•ˆ êµìœ¡**
- ì´í›„ ê¶Œí•œì— ëŒ€í•œ ì •ì±… ë…¼ì˜

**AWS Supportë¥¼ í†µí•´ ì§€ì†ì ìœ¼ë¡œ ë„ì›€ì„ ë°›ì•˜ë‹¤.**


![9](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/9.png)



#### ë³´í˜¸ ê³„ì • í•´ì§€


ë³´í˜¸ê³„ì •ì„ í•´ì§€í•˜ë ¤ë©´ ë³´ì•ˆ ê¶Œê³  ì‚¬í•­ì„ ìˆ˜í–‰í•˜ë¼ëŠ” ì—°ë½ì„ ë°›ëŠ”ë‹¤.


![10](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/10.png)


ë³´í˜¸ ê³„ì •ì— ìˆìœ¼ë©´ ì–´ë–¤ ë¬¸ì œê°€ ìˆì„ê¹Œ?


ê¸°ì¡´ ì„œë¹„ìŠ¤ ìš´ì˜ ìì²´ê°€ ë§‰íˆëŠ” ê²ƒì€ ì•„ë‹ˆì§€ë§Œ `Amplyfi` ìë™ ë°°í¬, SES ì „ì†¡ ë¶ˆê°€, ECS ì¶”ê°€ ì‚¬ìš© ë¶ˆê°€ ë“±ë“± ë§ì€ ê²ƒì— ì œì•½ì´ ê±¸ë¦¬ê²Œ ëœë‹¤.


ì˜ˆì‹œë¡œ SES ì „ì†¡ì´ ì•ˆë˜ì–´ í•œë„ ì¦ê°€ ìš”ì²­í–ˆë˜ ë‚´ì—­ì´ ìˆë‹¤.


![11](/assets/img/2024-10-04-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-root-ê¶Œí•œ-íƒˆì·¨ë¡œ-ECS-ìˆœì‹ê°„ì—-1000ë‹¬ëŸ¬-ë¹„ìš©-ë°œìƒ.md/11.png)


â‡’ ë³´ì•ˆ ì´ìŠˆë¡œ ë³´í˜¸ ê³„ì •ì— ë“¤ì–´ê°„ ìƒíƒœë©´ ë¶ˆê°€í•˜ë‹¤ëŠ” ì‘ë‹µì„ ë°›ì€ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.


ìš°ì—¬ê³¡ì ˆ ëì— ë³´ì•ˆ ì¡°ì¹˜ê°€ ì™„ë£Œ ë˜ì—ˆê³  ì´í›„ 2 ~ 3ì£¼ ì´í›„ ë³´í˜¸ê³„ì •ì€ í’€ë¦¬ê²Œ ëœë‹¤. ê·¸ë¦¬ê³  ì—¬ê¸°ê¹Œì§€ê°€ ëì¸ ì¤„ ì•Œì•˜ë‹¤. ë³´í˜¸ê³„ì •ì´ í’€ë¦° ë©°ì¹  ë’¤ ë˜ ë‹¤ì‹œ ë™ì¼í•œ í•´í‚¹ìƒí™©ì´ ë°œìƒí•˜ê²Œ ë˜ëŠ”ë°..ğŸ¥²ğŸ¥²

