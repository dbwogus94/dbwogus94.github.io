---
layout: post
date: 2025-05-02
title: "[í”„ë¡œì íŠ¸ | ë˜‘ì†Œ] API ë²„ì „ ë™ì‹œ ìš´ì˜ ì „ëµ"
tags: [ddokso, AWS, github-action, ]
categories: [í”„ë¡œì íŠ¸, ë˜‘ì†Œ, ]
mermaid: true
---


> ğŸ“Œ í•´ë‹¹ ê¸€ì—ì„œëŠ” ë‘ê°€ì§€ ë²„ì „ì˜ APIë¥¼ ë™ì‹œì— ìš´ì˜í•˜ê¸° ìœ„í•œ ì „ëµì„ êµ¬ì„±í•˜ëŠ” ê³¼ì •ì„ ì†Œê°œí•©ë‹ˆë‹¤.



ğŸ‘€Â **ë¯¸ë¦¬ë³´ê¸°**


![0](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/0.png)



### 1. ë°°ê²½


![1](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/1.png)


ë‚´ë¶€ ê¸°íšì— ë”°ë¼ ë˜‘ì†Œ 2.0 ë²„ì „ì€ Web í™˜ê²½ì„ ë¨¼ì € ì§€ì› í•˜ê¸°ë¡œ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤. 


ì˜ì‚¬ê²°ì •ì— ë”°ë¼ ê¸°ì¡´ v1.0 APIëŠ” Appì„ ì§€ì›í•˜ê³ , ì‹ ê·œ v2.0 APIëŠ” Web í™˜ê²½ì„ ì§€ì›í•˜ë„ë¡ í•´ì•¼í–ˆìŠµë‹ˆë‹¤.



#### 1.1. ìš”êµ¬ì‚¬í•­ ì •ë¦¬

- v1.0 API ì€ ê¸°ì¡´ appì„ ì§€ì›í•œë‹¤.
	- ì´í›„ app ë˜í•œ 2.0 ë²„ì „ì„ ê°œë°œ ì˜ˆì •
- v2.0 APIëŠ” ë˜‘ì†Œ 2.0 webì„ ì§€ì›í•œë‹¤.
- DBëŠ” í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ë©°, ë°°ì¹˜ì™€ ìŠ¤í¬ë˜í¼ëŠ” v1.0, v2.0ì„ ë™ì‹œì— ì§€ì›í•´ì•¼ í•œë‹¤.


#### 1.2. í˜„ì¬ ì¸í”„ë¼ ìƒí™©


![2](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/2.png)



### 2. ë¬¸ì œ í•´ê²° ë°©ì•ˆ



#### 2.1. ë°©ì•ˆ 1 - **Nestjsì—ì„œ ì œê³µí•˜ëŠ” ë²„ì €ë‹ ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤.**


Nestjsì—ì„œëŠ” ë²„ì €ë‹ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë²„ì €ë‹ì„ í†µí•´ ì†ì‰½ê²Œ API ë²„ì „ ì»¨íŠ¸ë¡¤ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.



{% raw %}
```typescript
import { Controller, Get, Version } from '@nestjs/common';

@Controller()
export class CatsController {
  @Version('1')
  @Get('cats')
  findAllV1(): string {
    return 'This action returns all cats for version 1';
  }

  @Version('2')
  @Get('cats')
  findAllV2(): string {
    return 'This action returns all cats for version 2';
  }
}
```
{% endraw %}


- ì°¸ê³ : [**Nestjs ê³µì‹ | ë²„ì €ë‹**](https://docs.nestjs.com/techniques/versioning)

**âœ…Â ì¥ì **

- **ë‹¨ì¼ ì½”ë“œë² ì´ìŠ¤ ê´€ë¦¬**: ë°°í¬/ëª¨ë‹ˆí„°ë§ì´ ê°„í¸
- **ìœ ì—°í•œ ë²„ì „ í˜¼ìš©**:Â **`@Version(['1', '2'])`**ë¡œ ë‹¤ì¤‘ ë²„ì „ ì§€ì›
- **ë‚®ì€ ì´ˆê¸° êµ¬í˜„ ë¹„ìš©**: ì†ŒìŠ¤ì½”ë“œ ìì²´ë¡œë§Œ êµ¬í˜„ ê°€ëŠ¥

**âÂ ë‹¨ì **

- **ì½”ë“œ ë³µì¡ë„ ì¦ê°€**: ì£¼ìš” ë³€ê²½ì‹œ ì¡°ê±´ ë¶„ê¸° ë°œìƒ ê°€ëŠ¥ì„±
- **ìŠ¤ì¼€ì¼ë§ ì œí•œ**: ëª¨ë“  ë²„ì „ì´ ë™ì¼ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©
- **ë°°í¬ ë¦¬ìŠ¤í¬**: ì‹ ê·œ ë²„ì „ ë°°í¬ì‹œ êµ¬ë²„ì „ ì˜í–¥ ê°€ëŠ¥ì„±
- **ì½”ë“œ ê´€ë¦¬ ë¹„ìš© ì¦ê°€**: í•˜ë‚˜ì˜ ì½”ë“œì—ì„œ ë‘ê°€ì§€ `Major` ë²„ì „ ê´€ë¦¬


#### 2.2. ë°©ì•ˆ 2 - **AWS ALBë¥¼ ì‚¬ìš©í•´ ë¶„ë¦¬í•œë‹¤.**


AWSì˜ ALBëŠ” â€œê·œì¹™â€ ì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·œì¹™ì„ í†µí•´ `path` ë³„ë¡œ íŠ¸ë ˆí”½ ì»¨íŠ¸ë¡¤ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.


![3](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/3.png)


**âœ…Â ì¥ì **

- **íŠ¸ë˜í”½ ê´€ë¦¬**: ë²„ì „ë³„ íŠ¸ë˜í”½ ë¶„ë¦¬ ë° ëª¨ë‹ˆí„°ë§ ë“± ê´€ë¦¬ í¸ë¦¬ì„± ì¦ëŒ€
- **ì½”ë“œ ê´€ë¦¬ ë¹„ìš© ê°ì†Œ**: gitì„ ì‚¬ìš©í•œ ë²„ì €ë‹ìœ¼ë¡œ ì½”ë“œ ê²©ë¦¬
- **ê²©ë¦¬ëœ ë°°í¬ í™˜ê²½**: github actionìœ¼ë¡œ ë²„ì „ë³„ ë°°í¬ í™˜ê²½ êµ¬ì¶•
- **ë²„ì „ë³„ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥**: ë²„ì „ë³„ Target Group ìš´ì˜ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥

**âÂ ë‹¨ì **

- **ë¹„ìš© ì¦ê°€**: ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš© ë° ê´€ë¦¬ ë¹„ìš© ì¦ê°€
- **ë²¤ë” ì˜ì¡´ì„±**: AWS ì¸í”„ë¼ì— ì˜ì¡´ì 
- **ê³µí†µ ì½”ë“œ ë²„ê·¸ ê´€ë¦¬ ë¹„ìš© ì¦ê°€:** ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì½”ì–´ ì½”ë“œì— ë²„ê·¸ ë°œìƒì‹œ ê´€ë¦¬ ë¹„ìš© ì¦ê°€


#### 2.3. ì„ íƒí•œ ë°©ë²• - **AWS ALBë¥¼ ì‚¬ìš©í•´ ê´€ë¦¬í•œë‹¤.**


ê²°ë¡ ì ìœ¼ë¡œ AWS ALBë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í•©ë‹ˆë‹¤. ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- **â€œë¹„ìš© ì¦ê°€â€** ë¬¸ì œ:

	í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ 2ê°€ì§€ ë²„ì „ì„ ë™ì‹œì— ì§€ì›í•˜ëŠ” ë°©ë²•ê³¼ ë²„ì „ ë³„ë¡œ ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìš´ì˜í•˜ëŠ” ë°©ë²• ë‘˜ë‹¤ ê²°ê³¼ì ìœ¼ë¡œ ë¹„ìš© ì¸¡ë©´ì—ì„œ í° ì°¨ì´ê°€ ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì´ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. ipë‚˜ ë³¼ë¥¨ ì‚¬ìš©ì— ëŒ€í•œ ì¶”ê°€ ë¹„ìš©ì€ ë°œìƒí•˜ê² ì§€ë§Œ ê·¸ ë¹„ìš©ë³´ë‹¤ ì•ìœ¼ë¡œì˜ ê´€ë¦¬ ë¹„ìš©ì´ ë” í¬ë‹¤ê³  íŒë‹¨í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

- **â€œë²¤ë” ì˜ì¡´ì„±â€** ë¬¸ì œ:

	ALBì˜ â€œê·œì¹™â€ì€ AWS ALBì˜ ìì²´ ê¸°ëŠ¥ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ `path` ë³„ë¡œ íŠ¸ë˜í”½ì„ ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì€ ëŒ€ë¶€ë¶„ì˜ ë¡œë“œë°¸ëŸ°ì„œ(Load Balancer)ì—ì„œ ì§€ì›í•˜ëŠ” ë³´í¸ì ì¸ ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

- **â€œê³µí†µ ì½”ë“œ ë²„ê·¸ ê´€ë¦¬ ë¹„ìš© ì¦ê°€â€** ë¬¸ì œ:

	ì´ ë¶€ë¶„ì€ ì—¬ì „íˆ ê³ ë¯¼ì¤‘ì— ìˆìŠµë‹ˆë‹¤. 


	ê°€ì¥ íš¨ê³¼ì ì´ë¼ê³  ìƒê°í•˜ëŠ” ë°©ì•ˆì€ ê³µí†µ ì½”ì–´ ì½”ë“œëŠ” `master` ë¸Œëœì¹˜ì—ì„œ ìˆ˜ì •í•˜ê³ , ë²„ì „ë³„ ë¸Œëœì¹˜ì¸ `ddokso-1.0`, `ddokso-2.0`ê°€ `master`ë¥¼ ë”°ë¼ê°€ê²Œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.


	![4](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/4.png)


**ê·¸ë¦¬ê³  ê°€ì¥ í° ì´ìœ ëŠ”** `Major` ë²„ì „ì´ ë‹¤ë¥¸ ë‘ ë²„ì „ì„ í•˜ë‚˜ì˜ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¥ê¸°ì ìœ¼ë¡œ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. (ë˜‘ì†Œ 2.0ì€ ì„œë¹„ìŠ¤ ì²´ì§ˆì„ ë³€ê²½í•˜ëŠ” ê³¼ì •ì— ë‚˜ì˜¨ ê²°ì •ì´ì—ˆìŠµë‹ˆë‹¤.)



### 3. ë²„ì „ ê´€ë¦¬ ì „ëµ êµ¬ì¶• ê³¼ì •


ë¨¼ì € ì¶”ê°€ ì¸í”„ë¼ ì—†ì´ ê¸°ì¡´ ì¸í”„ë¼ë¡œ ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. 


ê·¸ë˜ì„œ ì„ ì •ëœ ì¸í”„ë¼ëŠ” `AWS ALB`, `Git`, `Github Action` ì…ë‹ˆë‹¤.



#### 3.1. ì„¤ê³„ë„ 


![5](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/5.png)



#### 3.2. **ALB ê·œì¹™ ì •ì˜**


**3.2.1. ê¸°ì¡´ ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½(****`api.ddokso.com`****) ê·œì¹™ ì •ì˜**


![6](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/6.png)


**3.2.2.  v2 ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½(****`api.ddokso.com/v2/*`****) ê·œì¹™ ì •ì˜**


![7](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/7.png)


**3.2.3. ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸**


![8](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/8.png)

- ìš´ì˜ ë°°í¬ë¥¼ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— í˜„ì¬ëŠ” ì˜¬ë ¤ì§„ ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ë‹¤. ë•Œë¬¸ì— 503ì´ ëœ¨ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.


#### 3.3. ì¸ìŠ¤í„´ìŠ¤ì— self-hosted ì„¤ì¹˜


ì°¸ê³ : [Github ê³µì‹ë¬¸ì„œ | adding-self-hosted-runners](https://docs.github.com/ko/actions/hosting-your-own-runners/managing-self-hosted-runners/adding-self-hosted-runners)



#### 3.4. Github Action Workflow íŒŒì¼ ì •ì˜


> ğŸ’¡ v1.x.x. ë²„ì „ê³¼ v2.x.x ë²„ì „ git tag ë°°í¬ë¥¼ ìœ„í•´ ê°ê° workflow íŒŒì¼ì„ ì •ì˜í•©ë‹ˆë‹¤.


**3.4.1. ê¸°ì¡´ v1.x.x ë²„ì „ ë°°í¬(** **`deploy-prod-v1.yaml`****)**



{% raw %}
```yaml
name: (PROD)DDokso-API-v2 - Build and Deploy

on:
  push:
    tags:
      # v1.x.x 
      - v1.[0-9]+.[0-9]+
  workflow_dispatch:

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true
env:
  VERSION: ${{ github.sha }}

jobs:
  build:
    name: Build 
    runs-on: ubuntu-xxx
    # ... ìƒëµ
		    
  deploy:
    needs: build
    name: Deploy 
    # íƒœê·¸ë¥¼ ê°€ì§„ ëŸ¬ë„ˆë“¤ì—ê²Œ ë™ì‹œì— ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì„¤ì •
    runs-on: ${{ matrix.runner }}
    strategy:
      matrix:
        runner: [self-hosted, api-prod-v1]
        node-version: [v20.15.0]
    # ... ìƒëµ
```
{% endraw %}



**3.4.2. ì‹ ê·œ v2.x.x ë²„ì „ ë°°í¬(** **`deploy-prod-v2.yaml`****)**



{% raw %}
```yaml
name: (PROD)DDokso-API-v2 - Build and Deploy

on:
  push:
    tags:
      # v2.x.x 
      - v2.[0-9]+.[0-9]+
  workflow_dispatch:

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true
env:
  VERSION: ${{ github.sha }}

jobs:
  build:
    name: Build 
    runs-on: ubuntu-xxx
    # ... ìƒëµ
		    
  deploy:
    needs: build
    name: Deploy 
    # íƒœê·¸ë¥¼ ê°€ì§„ ëŸ¬ë„ˆë“¤ì—ê²Œ ë™ì‹œì— ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì„¤ì •
    runs-on: ${{ matrix.runner }}
    strategy:
      matrix:
        runner: [self-hosted, api-prod-v2]
        node-version: [v20.15.0]

      # ... ìƒëµ
```
{% endraw %}



**3.4.3. ì£¼ì˜ ì‚¬í•­**


`v1.x.x` ë²„ì „

- íƒœê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í™•ì¸


{% raw %}
```yaml
on:
  push:
    tags:
      - v1.[0-9]+.[0-9]+
```
{% endraw %}


- self-host íƒœê·¸ ì„¤ì • í™•ì¸
	- `runs-on: [self-hosted,` **`api-prod`**`]`

`v2.x.x` ë²„ì „

- íƒœê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í™•ì¸


{% raw %}
```yaml
on:
  push:
    tags:
      - v2.[0-9]+.[0-9]+
```
{% endraw %}


- self-host íƒœê·¸ ì„¤ì • í™•ì¸
	- `runs-on: [self-hosted,` **`api-prod-v2`**`]`

**3.4.4. git tag ë°°í¬ í™•ì¸**


![9](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/9.png)

- **`feat/ddokso-2.0`** **ë¸Œëœì¹˜ì—** **`v2.0.0`** **íƒœê·¸ ì ìš©**
- **`feat/ddokso-1.0`** **ë¸Œëœì¹˜ì—** **`v1.3.24`** **íƒœê·¸ ì ìš©**

**3.4.5. github workflows ì‹¤í–‰í™•ì¸**


![10](/assets/img/2025-05-02-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-API-ë²„ì „-ë™ì‹œ-ìš´ì˜-ì „ëµ.md/10.png)

