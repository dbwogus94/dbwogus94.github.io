---
layout: post
date: 2024-04-01
title: "[í”„ë¡œì íŠ¸ | ë˜‘ì†Œ] 5. Type Safe í•˜ì§€ ëª»í•œ Typeorm, ë„ë©”ì¸ ê°ì²´ë¡œ í•´ê²°í•´ ë³´ì•˜ë‹¤."
tags: [ì•„í‚¤í…ì²˜, Typeorm, ]
categories: [í”„ë¡œì íŠ¸, ë˜‘ì†Œ, ]
mermaid: true
---


> ğŸ“Œ Typeormì€ Node.jsì—ì„œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ORM ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Type Safe ì¸¡ë©´ì—ì„œ í•œê³„ê°€ ìˆì–´, í•´ë‹¹ í¬ìŠ¤íŒ…ì€ ì´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•œ ë°©ë²•ì¤‘ í•˜ë‚˜ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤.



### Overview - ORMì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ 


APIì„œë²„, ì›¹ì„œë²„, WASì„œë²„ ë“±ë“± ë‹¤ì–‘í•œ ì„œë²„ê°€ ìˆì§€ë§Œ ì„œë²„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— í•„ìš”í•œ ìì›ì„ ì„œë¹™í•©ë‹ˆë‹¤. ìì›ì€ ë‹¤ì–‘í•˜ê²Œ í•´ì„ë  ìˆ˜ ìˆì§€ë§Œ í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” API ì„œë²„ì™€ ì›¹ í´ë¼ì´ì–¸íŠ¸ ê´€ì ì—ì„œ ì„¤ëª…í•©ë‹ˆë‹¤.


ì €í¬ ë˜‘ì†Œ ì„œë¹„ìŠ¤ëŠ” ìœ ì €ì—ê²Œ ë‹¤ì–‘í•œ ìƒí’ˆ UIë¥¼ ì œê³µí•©ë‹ˆë‹¤.


ìœ ì €ê°€ ë°”ë¼ë³´ëŠ” ìƒí’ˆ UIëŠ” ë‹¤ì–‘í•  ìˆ˜ ìˆì§€ë§Œ, API ì„œë²„ ì…ì¥ì—ì„œëŠ” **ìƒí’ˆì´ë¼ëŠ” ìì›ì„ ì‘ë‹µí•˜ëŠ” ê²ƒì— ë¶ˆê³¼í•©ë‹ˆë‹¤.**


![0](/assets/img/2024-04-01-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-5.-Type-Safe-í•˜ì§€-ëª»í•œ-Typeorm-ë„ë©”ì¸-ê°ì²´ë¡œ-í•´ê²°í•´-ë³´ì•˜ë‹¤..md/0.png)_ìœ„ APIì—ì„œëŠ” ëª¨ë‘ ìƒí’ˆë¦¬ìŠ¤íŠ¸ì— í•„ìš”í•œ â€œìƒí’ˆâ€ ìì›ì„ ì‘ë‹µí•©ë‹ˆë‹¤._


ê·¸ë ‡ë‹¤ë©´ API ì„œë²„ëŠ” ìƒí’ˆì´ë¼ëŠ” ìì›ì„ UIì— ë³´ì´ëŠ” ê·¸ëŒ€ë¡œ ë³´ê´€í•˜ê³  ìˆì„ê¹Œìš”? 
UIì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë“¤ê³  ìˆë‹¤ë©´ ì •ë§ ì¢‹ê² ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œëŠ” ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸° í¸í•œ í˜•íƒœë¡œ ë³´ê´€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë°ì´í„° ë³´ê´€ì„ ì˜í•˜ê¸° ìœ„í•´ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ëŠ” RDBMSì…ë‹ˆë‹¤.

- API ì„œë²„ì—ì„œ ì œê³µí•˜ëŠ” **ìƒí’ˆì€** ì—¬ëŸ¬ í…Œì´ë¸” ë°ì´í„°ì˜ ì¡°í•©ì…ë‹ˆë‹¤.

![1](/assets/img/2024-04-01-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-5.-Type-Safe-í•˜ì§€-ëª»í•œ-Typeorm-ë„ë©”ì¸-ê°ì²´ë¡œ-í•´ê²°í•´-ë³´ì•˜ë‹¤..md/1.png)_product ê´€ë ¨ ì¼ë¶€ ERD_



#### API ì„œë²„ëŠ” ê°ì²´ë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.


API ì„œë²„ì—ì„œëŠ” 'ìƒí’ˆ' í•˜ë‚˜ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ í…Œì´ë¸”ì˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤. API ì„œë²„ëŠ” ì—¬ëŸ¬ í…Œì´ë¸”ì„ JOINí•´ì„œ í•˜ë‚˜ì˜ 'ìƒí’ˆ' ì •ë³´ë¥¼ ë§Œë“­ë‹ˆë‹¤.

- RDBMSì˜ `product`ì™€ API ì„œë²„ì˜ `Product` ê°ì²´

![2](/assets/img/2024-04-01-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-5.-Type-Safe-í•˜ì§€-ëª»í•œ-Typeorm-ë„ë©”ì¸-ê°ì²´ë¡œ-í•´ê²°í•´-ë³´ì•˜ë‹¤..md/2.png)


ìƒí’ˆ APIì—ì„œ ìƒí’ˆì„ ì‘ë‹µí•˜ëŠ” ëª¨ë“  ë¡œì§ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ì‘ì—…ì´ ë°˜ë³µë©ë‹ˆë‹¤.

1. JOIN Queryë¥¼ ì‚¬ìš©í•´ì„œ DBì—ì„œ JOINëœ ìƒí’ˆ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
2. DBì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ Product ê°ì²´ì— ë§¤í•‘í•˜ê¸°

ì´ëŸ¬í•œ ë°˜ë³µ ì‘ì—…ì€ ë‹¤ì–‘í•œ ë¬¸ì œë¥¼ ë§Œë“¤ì—ˆê³ , ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„ ë°° ê°œë°œì ë¶„ë“¤ì€ ORMì´ë¼ëŠ” ê¸°ìˆ ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.


ë‹¤ì–‘í•œ ORMì´ ì¡´ì¬í•˜ì§€ë§Œ ORMì€ í¬ê²Œ ë‘ê°€ì§€ ì—­í• ì„ ì œê³µí•œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

- SELETE Queryë¥¼ ì¶”ìƒí™”í•´ ê°ì²´ ì…ì¥ì—ì„œ ì§ˆì˜ë¥¼ ì œê³µ
- DBì—ì„œ ì‘ë‹µëœ ë°ì´í„°ë¥¼ ê°ì²´ì— ë§¤í•‘

í¬ìŠ¤íŒ…ì—ì„œëŠ” nodejs ëŸ°íƒ€ì„ì—ì„œëŠ” ë§ì´ ì‚¬ìš©í•˜ëŠ” typeormì˜ ëŒ€í‘œì ì¸ ë‹¨ì ì¸ type-safe ë¬¸ì œì— ëŒ€í•œ í•œê°€ì§€ ëŒ€ì•ˆì„ ì†Œê°œí•©ë‹ˆë‹¤.



###  1. Typeormì€ type-safeë¥¼ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.


ìš°ë¦¬ëŠ” Type Safetyí•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ Typescriptë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ Typescript í™˜ê²½ì—ì„œë„ Typeormì„ ì‚¬ìš©í•˜ë©´, Type Safe í•˜ì§€ ëª»í•œ ì½”ë“œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


ì•„ë˜ `ProductEntity`ê°€ ìˆìŠµë‹ˆë‹¤.



{% raw %}
```typescript
@Entity('product')
export class ProductEntity {
  @PrimaryGeneratedColumn({ type: 'bigint', name: 'id', comment: 'ID' })
  id: string;

  @Column('varchar', { comment: 'ìƒí’ˆëª…' })
  title: string;

  @Column('varchar', { comment: 'ì´ë¯¸ì§€ URL', length: 1000 })
  imageUrl: string;

  @Column('tinyint', { comment: 'ì¬ê³ ìœ ë¬´', default: 1 })
  isStock: number;

  /* ============= ì—°ê´€ê´€ê³„ ============= */
  @OneToMany(
    () => ProductCategoryEntity,
    (productCategory) => productCategory.product,
    { nullable: false },
  )
  productCategories: ProductCategoryEntity[];

  @OneToOne(() => ProductPriceEntity, (price) => price.product, {
    nullable: false,
    cascade: true,
  })
  price: ProductPriceEntity;
  
  @OneToMany(() => Notification, (noti) => noti.product, {
    nullable: true,
  })
  notifications?: Notification[];
}
```
{% endraw %}



ìœ„ì— ì •ì˜ëœ `ProductEntity`ëŠ” product í…Œì´ë¸”ì„ ì¶”ìƒí™” í•©ë‹ˆë‹¤. ì´ë¥¼ ORM Entityë¼ê³  í•©ë‹ˆë‹¤. 


ë§ì€ ê²½ìš° ORM Entityë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ORM Entityë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸ëŠ” ORM Entityê°€ ë„ë©”ì¸ ê·œì¹™ì„ ê°€ì§€ê²Œ ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.


`ProductEntity` ë„ë©”ì¸ ê·œì¹™ì€?

1. ë¹„ì¦ˆë‹ˆìŠ¤ì ì¸ ì •ì±…ì— ì˜ê±°í•´ `ProductEntity`ì˜ ëª¨ë“  í•„ë“œì— **ì˜µì…”ë„ì´ ì•„ë‹Œ ê°’ì€ í•­ìƒ ì¡´ì¬í•©ë‹ˆë‹¤.**
	- ì‹ë³„ì(`id`), ìƒí’ˆëª…(`title`), ì´ë¯¸ì§€ URL(`imageUrl`), ì¬ê³ ìœ ë¬´(`isStock`)ì€ ëª¨ë‘ í•­ìƒ ì¡´ì¬
2. `nullable: false`ì¸ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.
	- ìƒí’ˆì˜ ê°€ê²© ì •ë³´(`price`)ëŠ” í•­ìƒ ì¡´ì¬í•œë‹¤.
	- ìƒí’ˆì€ í•˜ë‚˜ ì´ìƒì˜ ì¹´í…Œê³ ë¦¬ì™€ ë§¤í•‘(`productCategories`)ëœë‹¤.


#### 1.1. type-safeë¥¼ ë³´ì¥í•˜ì§€ ëª»í•˜ëŠ” ìƒí™© ì˜ˆì‹œ

1. íŠ¹ì • í•„ë“œë§Œ `SELECT` - ìƒí’ˆì˜ íŠ¹ì • í•„ë“œë§Œ ì„ íƒí•´ì„œ ì¡°íšŒ


{% raw %}
```typescript
const productRepo = dataSource.getRepository(ProductEntity);
const product = await productRepo.findOne({
	select: { id: true, title: true }
	where: { id: '1' }
});

// Typescript ì»´íŒŒì¼ëŸ¬ëŠ” ì•„ë˜ì˜ ê°’ì´ ìˆë‹¤ê³  ì¸ì‹í•©ë‹ˆë‹¤.
product.imageUrl;
product.isStock;
```
{% endraw %}



íŠ¹ì • í•„ë“œë§Œ ì„ íƒí•´ ì¡°íšŒí•œ ìƒí™©ì—ì„œ, ì¡°íšŒë˜ì§€ ì•Šì€ í•„ë“œë¥¼ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.


í•˜ì§€ë§Œ TypescriptëŠ” ì—ëŸ¬ë¥¼ ë‚´ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ **ì½”ë“œëŠ” ëŸ°íƒ€ì„ì´ ë˜ì„œì•¼ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.**

1. JOIN ì—†ì´ `SELECT` - ì—°ê´€ê´€ê³„ í…Œì´ë¸” ì¡°íšŒí•˜ì§€ ì•ŠìŒ


{% raw %}
```typescript
const productRepo = dataSource.getRepository(ProductEntity);
const product = await productRepo.findOneBy({ id: '1' });

// Typescript ì»´íŒŒì¼ëŸ¬ëŠ” ì•„ë˜ì˜ ê°’ì´ ìˆë‹¤ê³  ì¸ì‹í•©ë‹ˆë‹¤.
product.price;
product.productCategories;
```
{% endraw %}



ì—°ê´€ê´€ê³„ í…Œì´ë¸”ì„ JOIN í•˜ì§€ ì•Šì€ ìƒí™©ì—ì„œ, ì—°ê´€ê´€ê³„ í•„ë“œë¥¼ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.


í•˜ì§€ë§Œ TypescriptëŠ” ì—ëŸ¬ë¥¼ ë‚´ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤. **ì´ ì½”ë“œ ë˜í•œ ëŸ°íƒ€ì„ì´ ë˜ì„œì•¼ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.**


ì˜ˆì‹œì˜ ê²½ìš°ëŠ” ì•„ì£¼ ë‹¨ìˆœí•œ ì½”ë“œì…ë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— í¬ê²Œ ìœ„í—˜í•˜ì§€ ì•Šì•„ ë³´ì…ë‹ˆë‹¤. 
í•˜ì§€ë§Œ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œëŠ” ë‹¨ìˆœí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë¬¸ì œëŠ” ë” ì»¤ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ê²Œë‹¤ê°€ ê³„ì¸µí˜• ì•„í‚¤í…ì²˜ì— ë”°ë¼, ORM ë¡œì§ì„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë¶„ë¦¬í•œ ê²½ìš°ëŠ” ë…ì´ ë˜ê¸°ë„ í•©ë‹ˆë‹¤. 


ê²°ê³¼ì ìœ¼ë¡œ Typeormì˜ ì‚¬ìš©ì€ Type Safe í•˜ì§€ ëª»í•œ ì½”ë“œë¥¼ ì–‘ì‚°í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ì´ëŠ” TypeScriptì˜ ì¥ì ì„ ì¶©ë¶„íˆ í™œìš©í•˜ì§€ ëª»í•˜ê²Œ ë˜ê³ , ëŸ°íƒ€ì„ ì—ëŸ¬ ìœ„í—˜ì„ ì¦ê°€ì‹œí‚¤ê³ , ì½”ë“œì˜ ì•ˆì •ì„±ì„ ë‚®ì¶”ê²Œ ë©ë‹ˆë‹¤.



#### 1.2. ë¬¸ì œ ë°œìƒ ì´ìœ 


ë¬¸ì œëŠ” í¬ê²Œ ë‘ ê°€ì§€ ê´€ì ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤

1. **TypeORMì˜ íƒ€ì… ì¶”ë¡  ë°©ì‹**
	- **Entity í´ë˜ìŠ¤ í•˜ë‚˜ë¡œ ëª¨ë“  ì¡°íšŒ ê²°ê³¼ì˜ íƒ€ì…ì„ ì •ì˜**í•©ë‹ˆë‹¤.
	- ì¦‰,Â **`select`**,Â **`relations`**Â ë“± ì¡°íšŒ ì¡°ê±´ì— ë”°ë¼ ì‹¤ì œë¡œëŠ” ë‹¤ë¥¸ ë°ì´í„°ê°€ ë°˜í™˜ë˜ì–´ë„, TypeScriptëŠ” í•­ìƒ Entityì— ì •ì˜ëœ ëª¨ë“  í•„ë“œê°€ ì¡´ì¬í•œë‹¤ê³  íŒë‹¨í•©ë‹ˆë‹¤.
	- ë‹¤ë¥¸ ORMë“¤ì€ ì¡°íšŒ ì¡°ê±´ì— ë”°ë¼ ë°˜í™˜ íƒ€ì…ì´ ìë™ìœ¼ë¡œ ë³€ê²½ë˜ëŠ” ë°˜ë©´, TypeORMì€ ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤.
2. **TypeScriptì˜ íƒ€ì… ì‹œìŠ¤í…œ í•œê³„**
	- TypeScriptëŠ” ì»´íŒŒì¼ íƒ€ì„ì— íƒ€ì…ì„ ì²´í¬í•©ë‹ˆë‹¤.
	- í•˜ì§€ë§Œ TypeORMì€ ëŸ°íƒ€ì„ì— ì‹¤ì œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ë¯€ë¡œ, ì»´íŒŒì¼ íƒ€ì„ì˜ íƒ€ì… ì²´í¬ê°€ ëŸ°íƒ€ì„ì˜ ì‹¤ì œ ë°ì´í„° êµ¬ì¡°ë¥¼ ì •í™•íˆ ë°˜ì˜í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ TypeORMì„ ì‚¬ìš©í•˜ë©´ TypeScriptì˜ ê°€ì¥ í° ì¥ì ì¸ íƒ€ì… ì•ˆì •ì„±ì„ ì œëŒ€ë¡œ í™œìš©í•˜ì§€ ëª»í•˜ê²Œ ë©ë‹ˆë‹¤.



##  2. ë¬¸ì œë¥¼ í•´ê²°í•´ ë³´ì


Typeormì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì„ íƒì§€ë„ ìˆì§€ë§Œ, ì¡°ê¸ˆ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ë¬¸ì œë¥¼ í’€ì–´ë´¤ìŠµë‹ˆë‹¤.


**ë¬¸ì œ ì •ì˜**

- ê²°êµ­ ë¬¸ì œëŠ” Entityì˜ í•„ë“œëŠ” Entityì— ì •ì˜ëœ íƒ€ì…ê³¼ ë‹¤ë¥´ê²Œ **`select`**,Â **`relations`**Â ë“± ì¡°íšŒ ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë³€ê²½ë˜ì–´ ëŸ°íƒ€ì„ ì—ëŸ¬ë¥¼ ìœ ë°œí•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**

- Typeormì˜ Entityë¥¼ ê²©ë¦¬í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì¶©ì‹¤í•˜ê²Œ ìˆ˜í–‰ ê°€ëŠ¥í•œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” Domain ê°ì²´ë¥¼ ì„ ì–¸í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


#### 2.1. Domain ê°ì²´ë¥¼ ì •ì˜í•˜ì


ë¨¼ì € Type Safeí•˜ê²Œ ì‚¬ìš©í•  ê°ì²´ë¥¼ í•˜ë‚˜ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.


3 ê³„ì¸µ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³¼ ë•Œ ì˜ì†í™” ê³„ì¸µì—ì„œ ì‘ë‹µëœ ë°ì´í„°ëŠ” ì£¼ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì¸µì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤. ë•Œë¬¸ì— Type Safeí•˜ê²Œ ì‚¬ìš©í•  ê°ì²´ëŠ” Domain ê°ì²´ê°€ ì í•©í•˜ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.


> ğŸ’¡ Domain ê°ì²´ë€ ë¬´ì—‡ì¼ê¹Œìš”?


Domain ê°ì²´ë¥¼ ë§í•˜ë©´ ì£¼ë¡œ, DDD ê´€ì ì˜ ë„ë©”ì¸ ê°ì²´ê°€ ë– ì˜¬ë¦´ ìˆ˜ ìˆì§€ë§Œ, DDDë¥¼ ë…¼í•˜ëŠ” ê¸€ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë‹¨ìˆœí•˜ê²Œ **â€œDomain ê°ì²´ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— í•„ìš”í•œ ì •ë³´ë¥¼ ëª¨ë‘ ê°€ì§„ ê°ì²´ì´ë‹¤.â€** ë¼ê³  ì •ì˜í•´ ë´¤ìŠµë‹ˆë‹¤.

- `ProductDomain` ê°ì²´ ì˜ˆì‹œ


{% raw %}
```typescript
interface ProductProps {
  id: string;
  title: string;
  imageUrl: string;
  isStock: boolean;
  price: ProductPriceEntity;
  productCategories: ProductCategoryEntity[];
}

class Product {
  constructor(readonly props: ProductProps) {}

  get id(): string {
    return this.props.id;
  }

  get title(): string {
    return this.props.title;
  }

  get imageUrl(): string {
    return this.props.imageUrl;
  }
	// ...ìƒëµ 
	
  get **isAvailable**(): boolean {
    return this.props.isStock;
  }
  
  **hasCategory**(categoryId: string): boolean {
    return this.props.productCategories.some(category => category.id === categoryId);
  }
}
```
{% endraw %}


- `ProductProps` ì—ëŠ” ìƒí’ˆ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— í•„ìš”í•œ ëª¨ë“  í•„ë“œë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤.
	- `notifications`ì˜ ê²½ìš° ìƒí’ˆ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ê´€ë¦¬í•  ì±…ì„ì´ ì—†ê¸° ë•Œë¬¸ì— í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” í•„ë“œ, íŠ¹ì • í–‰ë™ì„ ê°€ì§€ëŠ” ë©”ì„œë“œë¥¼ í¬í•¨í•˜ê¸°ë„ í•©ë‹ˆë‹¤.

> ğŸ’¡ ê·¸ëŸ¬ë©´ EntityëŠ” Domain ê°ì²´ê°€ ì•„ë‹ê¹Œìš”?


ì €ëŠ” ê¼­ ë‘˜ì´ ì¼ì¹˜í•œë‹¤ê³  ìƒê°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. EntityëŠ” DBì˜ Tableë¥¼ ì¶”ìƒí™”í•œ ê°ì²´ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  DBì˜ í…Œì´ë¸”ì´ ëª¨ë“  í”„ë¡œë•íŠ¸ì˜ ë°ì´í„°ë¥¼ ë“¤ê³  ìˆëŠ” ê²ƒì´ ë§ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Entityê°€ Domain ê°ì²´ë¥¼ ì˜¤ë¡¯ì´ ë‹´ë‹¹í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.

1. DBì˜ ë°ì´í„°ê°€ í•­ìƒ ì„œë¹„ìŠ¤ ë¡œì§ì— ì‚¬ìš©í•˜ê¸° ì í•©í•˜ë‹¤ëŠ” ë³´ì¥ì€ ì—†ìŠµë‹ˆë‹¤.
2. DBì˜ ì—°ê´€ê´€ê³„ë¥¼ Entityë¡œ ëª¨ë‘ í‘œí˜„ í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, ì‹¤ì œ ëŸ°íƒ€ì„ì— Entityê°€ ëª¨ë“  ì—°ê´€ê´€ê³„ ë°ì´í„°ë¥¼ ë“¤ê³  ìˆê¸°ì—ëŠ” ë¬¼ë¦¬ì ì¸ í•œê³„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.


#### 2.2. ì˜ì†ì„± ê³„ì¸µ(Repository)ë¡œ typeormì˜ entityë¥¼ ê²©ë¦¬í•˜ì.


> ğŸ“Œ ì˜ì†ì„± ê³„ì¸µ(Repository) ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ â€œ[**Repository íŒ¨í„´ì—ì„œ â€˜ëª…ì‹œì  íŠ¸ëœì­ì…˜â€™ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•**](https://dbwogus94.github.io/posts/%EA%B0%9C%EB%B0%9C-Typescript-Repository-%ED%8C%A8%ED%84%B4%EC%97%90%EC%84%9C-%EB%AA%85%EC%8B%9C%EC%A0%81-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%98%AC%EB%B0%94%EB%A5%B4%EA%B2%8C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95/)**â€** í¬ìŠ¤íŒ…ì„ ì°¸ê³ í•´ ì£¼ì„¸ìš”


3 ê³„ì¸µ ì•„í‚¤í…ì²˜ì—ì„œëŠ” ì˜ì†ì„± ê³„ì¸µì„ ì‚¬ìš©í•´ DBì™€ í†µì‹ í•˜ëŠ” ì½”ë“œë¥¼ ê²©ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì•ì„œ ì„¤ëª…ì²˜ëŸ¼ ì˜ì†í™” ê³„ì¸µì—ì„œ Entityë¥¼ ë¦¬í„´í•˜ê²Œ ë˜ë©´ type-safeë¥¼ ë³´ì¥í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤.


ê·¸ë ‡ê¸°ì— ì¡°íšŒ ë¡œì§ì—ì„œ ë¦¬í„´ë˜ëŠ” ê²°ê³¼ë¥¼ Domain ê°ì²´ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤. Domain ê°ì²´ëŠ” í•­ìƒ ë™ì¼í•œ typeë¥¼ ë³´ì¥í•˜ë©°, Type Safeí•˜ê²Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.


**ì¤‘ìš”í•œ ì ì€ ì˜ì†ì„± ê³„ì¸µì€ í•­ìƒ ë™ì¼í•œ Domainì„ ì‘ë‹µí•˜ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.**



#### 2.3. ì‹¤ì œ êµ¬í˜„í•œ ì½”ë“œë¥¼ í†µí•´ ë™ì‘ í™•ì¸


![3](/assets/img/2024-04-01-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-5.-Type-Safe-í•˜ì§€-ëª»í•œ-Typeorm-ë„ë©”ì¸-ê°ì²´ë¡œ-í•´ê²°í•´-ë³´ì•˜ë‹¤..md/3.png)

1. `ProductRepository`: Product Entityë¥¼ ì‚¬ìš©í•˜ëŠ” orm ë¡œì§ì„ ê²©ë¦¬í•˜ê³  ëª¨ë“ˆí™”í•©ë‹ˆë‹¤.


{% raw %}
```typescript
export abstract class ProductRepositoryPort extends BaseRepository<ProductEntity> {
  abstract findManyAndCount(
    options?: FindManyOptions,
  ): Promise<[Product[], number]>;
  // ... ìƒëµ
}

@Injectable()
export class ProductRepository extends ProductRepositoryPort {
  // constructor ìƒëµ
  
  override async findManyAndCount(
    options: FindManyOptions,
  ): Promise<[Product[], number]> {
    // ...ìƒëµ
    const [products, count] = await this.#findManyAndCount(options);
    return [ProductEntityMapper.toDomain(products), count];
  }
}
```
{% endraw %}


1. `ProductEntityMapper`: `ProductEntity`ë¥¼ `Product` ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.


{% raw %}
```typescript
export class ProductEntityMapper {
  static toDomain(entity: ProductEntity[]): Product[];
  static toDomain(entity: ProductEntity): Product;
  static toDomain(
    entity: ProductEntity | ProductEntity[],
  ): Product | Product[] {
    if (Array.isArray(entity)) 
      return entity.map((e) => this.toDomain(e));
    
    const { price, ...pureProduct } = entity;
    const { isStock, ...other } = pureProduct;
    return new Product({
      ...other,
      isStock: !!isStock, // DBì™€ ìŠ¤í‚¤ë§ˆ ì°¨ì´ ë³´ì •
      price: ProductPriceEntityMapper.toDomain(price),
    }).setBase(entity.id, entity.createdAt, entity.updatedAt, entity.deletedAt);
  }
}
```
{% endraw %}


1. `Product`: ìƒí’ˆì— ëŒ€í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ êµ¬í˜„í•œ ê°ì²´ ì…ë‹ˆë‹¤.


{% raw %}
```typescript
interface ProductProps {
  id: string;
  title: string;
  imageUrl: string;
  isStock: boolean;
  price: ProductPriceEntity;
  productCategories: ProductCategoryEntity[];
}

class Product {
  constructor(readonly props: ProductProps) {}

  get id(): string {
    return this.props.id;
  }
  // ...ìƒëµ 
}
```
{% endraw %}


1. `ProductService`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•œ ê³„ì¸µì´ë©°, Domain ê°ì²´ë¥¼ ì§ì ‘ ì‚¬ìš©í•©ë‹ˆë‹¤.


{% raw %}
```typescript
export abstract class ProductServiceUseCase {
  abstract getProducts(
    query: GetProductsQuery,
  ): Promise<GetProductsResponseWithTotalCount>;
	// ... ìƒëµ
}

@Injectable()
export class ProductService extends ProductServiceUseCase {
  // constructor ìƒëµ

  override async getProducts(
    query: GetProductsQuery,
  ): Promise<GetProductsResponseWithTotalCount> {
    const { state, sort, categoryId, brandId, tag, ...pagination } = query;
    
    const [products, totalCount] = await this.productRepo.findManyAndCount({
      where: { state, tag, categoryId, brandId },
      sort,
      pagination,
    });

    return GetProductsResponseWithTotalCount.of({
      results: products,
      totalCount,
    });
  }
}
```
{% endraw %}




## ë§ˆë¬´ë¦¬


í˜„ì¬ êµ¬í˜„ëœ ë°©ë²•ë„ ì™„ë²½í•˜ê²Œ Type Safetyí•˜ê²Œ ë§Œë“¤ê¸°ëŠ” ì–´ë µìŠµë‹ˆë‹¤. 
Mapperì—ì„œ íƒ€ì… ì²´í¬ê°€ ì™„ë²½í•˜ê²Œ ìˆ˜í–‰ë˜ì§€ ì•Šìœ¼ë©´ ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.


ë˜í•œ í•­ìƒ ë™ì¼í•œ Domain ê°ì²´ë¥¼ ë‚´ë³´ë‚´ê¸° ìœ„í•´ ì˜¤ë²„íŒ¨ì¹­ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ë„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.


ê·¸ëŸ¼ì—ë„ ì´ëŸ¬í•œ ë°©ë²•ì„ ì‚¬ìš©í•´ ë” ì•ˆì „í•œ Type, ëª…í™•í•œ ì½”ë“œë¶„ë¦¬ì™€ ì±…ì„ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



#### 2024ë…„ 12ì›” ìƒê° ì¶”ê°€


ë¶€ì¡±í•¨ì„ ì¸ì§€í•˜ê³  9ì›”ë¶€í„° 10ì£¼ê°„ ì„±ì¥ì„ ìœ„í•´ í•­í•´ í”ŒëŸ¬ìŠ¤ë¼ëŠ” ì½”ìŠ¤ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ê³¼ì •ì„ ì§„í–‰í•˜ë©° ì—¬ëŸ¬ ë°±ì—”ë“œ ì‹œë‹ˆì–´ ê°œë°œì ë¶„ë“¤ì´ ìƒê°í•˜ì‹œëŠ” ë„ë©”ì¸ ê°ì²´ì— ëŒ€í•œ ìƒê°ì„ ì—¿ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.


ê·¸ë¦¬ê³  ORM Entityì™€ Domain ê°ì²´ì— ëŒ€í•œ ìƒê°ì€ ìì—°ìŠ¤ëŸ½ê²Œ â€œë„ë©”ì¸ ëª¨ë¸ë§â€ê³¼ â€œì•„í‚¤í…ì²˜ ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì½”ë“œâ€ì— ëŒ€í•œ ê³ ì°°ë¡œ ì´ì–´ì¡ŒìŠµë‹ˆë‹¤. 


ê´€ë ¨ í¬ìŠ¤íŒ…ì´ ì •ë¦¬ë˜ë©´ í•˜ë‹¨ì— ë§í¬ë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

