---
layout: post
date: 2024-06-07
title: "[í”„ë¡œì íŠ¸ | ë˜‘ì†Œ] 10. Sitemap ë™ì  ìƒì„±ê³¼ ë°°í¬ íŒŒì´í”„ë¼ì¸ 1í¸"
tags: [AWS, RDS, sitemap, ddokso, ]
categories: [í”„ë¡œì íŠ¸, ë˜‘ì†Œ, ]
mermaid: true
---


> ğŸ“Œ í¬ìŠ¤íŒ… 1í¸ê³¼ 2í¸ìœ¼ë¡œ ë‚˜ëˆ„ì—ˆìœ¼ë©°, í•´ë‹¹ í¬ìŠ¤íŒ…ì€ 1í¸ì…ë‹ˆë‹¤.



### ìš”êµ¬ì‚¬í•­

- ë§¤ì¼ ë§¤ì¼ ì¦ê°€í•˜ëŠ” ìƒí’ˆì„ íŠ¹ì • ì¡°ê±´ì— ë§ê²Œ Sitemapìœ¼ë¡œ ìƒì„±í•˜ê³  ë°°í¬í•œë‹¤.
- ìƒí’ˆ ì •ë³´ê°€ ì´ë¯¸ 50ë§Œê°œë¥¼ ë„˜ëŠ” ìƒí™©ì´ê¸° ë•Œë¬¸ì— ìš°ì„ ìˆœìœ„ë¥¼ ì •í•´ì„œ ë…¸ì¶œí•œë‹¤.


#### sitemap ë™ì  ìƒì„± ë°°í¬ë¥¼ ìœ„í•œ ê¸°ëŠ¥ ì •ì˜

1. Sitemapì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” script ì •ì˜
2. ì¼ì • ì£¼ê¸° ë˜ëŠ” ì›í•˜ëŠ” ì‹œì ì— scriptë¥¼ ì‹¤í–‰í•  ì‹¤í–‰ í™˜ê²½
3. ìƒì„±ëœ sitemapì„ í˜¸ìŠ¤íŒ…


#### ìµœì¢… ì„¤ê³„ëœ ì•„í‚¤í…ì²˜


![0](/assets/img/2024-06-07-í”„ë¡œì íŠ¸--ë˜‘ì†Œ-10.-Sitemap-ë™ì -ìƒì„±ê³¼-ë°°í¬-íŒŒì´í”„ë¼ì¸-1í¸.md/0.png)



### 1. Sitemapì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” script ì •ì˜


*ì½”ë“œ êµ¬í˜„ì˜ ê²½ìš° ë¹„ì¦ˆë‹ˆìŠ¤ë§ˆë‹¤ ë‹¤ë¥´ê³ , ì˜ˆì‹œ ì½”ë“œê°€ ë§ê¸° ë•Œë¬¸ì— í•´ë‹¹ í¬ìŠ¤íŒ…ì—ì„œëŠ” ìƒëµí•˜ê³ , ì£¼ë¡œ ì°¸ê³ í•œ ë‚´ìš©ì„ ë§í¬ë¡œ ë‹¬ì•„ë‘ê² ìŠµë‹ˆë‹¤.

- [**Automating Sitemap Generation with Node.js: The Step-by-Step Guide**](https://codebeyondlimits.com/articles/automating-sitemap-generation-with-node-js-the-step-by-step-guide)
- [nodejs ì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ](https://www.npmjs.com/package/sitemap)[`sitemap`](https://www.npmjs.com/package/sitemap)[ ë¼ì´ë¸ŒëŸ¬ë¦¬](https://www.npmjs.com/package/sitemap)
- [`sitemap`](https://github.com/ekalinin/sitemap.js?tab=readme-ov-file#options-you-can-pass)[ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ˆì‹œ ì½”ë“œ](https://github.com/ekalinin/sitemap.js?tab=readme-ov-file#options-you-can-pass)


#### 1.1. ìƒì„±ëœ sitemap ì˜ˆì‹œ

- sitemap ì¸ë±ìŠ¤ íŒŒì¼: `sitemap-index.xml.gz`(ì••ì¶• í•´ì œ ìƒíƒœ)


{% raw %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:news="http://www.google.com/schemas/sitemap-news/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml"
  xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"
  xmlns:video="http://www.google.com/schemas/sitemap-video/1.1">
  <url>
    <loc>https://www.ddokso.com/sitemap-appliance-digital-1.xml.gz</loc>
  </url>
  <url>
    <loc>https://www.ddokso.com/sitemap-base-sitemap.xml.gz</loc>
    <lastmod>2024-06-29T15:00:00.000Z</lastmod>
  </url>
</urlset>
```
{% endraw %}


- ì¸ë±ìŠ¤ì— í¬í•¨ë˜ëŠ” í•˜ìœ„ sitemap: `sitemap-base-sitemap.xml.gz`(ì••ì¶• í•´ì œ ìƒíƒœ)


{% raw %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:news="http://www.google.com/schemas/sitemap-news/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml"
  xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"
  xmlns:video="http://www.google.com/schemas/sitemap-video/1.1">
  <url>
    <loc>https://www.ddokso.com/</loc>
    <lastmod>2024-06-29T15:00:00.000Z</lastmod>
  </url>
  <url>
    <loc>https://www.ddokso.com/search</loc>
    <lastmod>2024-06-29T15:00:00.000Z</lastmod>
  </url>
  // ... ìƒëµ
</urlset>
```
{% endraw %}




### 2. ì¼ì • ì£¼ê¸° ë˜ëŠ” ì›í•˜ëŠ” ì‹œì ì— scriptë¥¼ ì‹¤í–‰í•  í™˜ê²½ ì„ ì •


ì½”ë“œ ì‹¤í–‰ í™˜ê²½ì€ ë‹¤ì–‘í•œ ì„ íƒì§€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë§ì€ ì„ íƒì§€ì¤‘ 3ê°€ì§€ë¥¼ ê°€ì§€ê³  ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤.

1. APIë‚˜ ë°°ì¹˜ê°€ ì‹¤í–‰ë˜ëŠ” ì„œë²„
2. AWSë¥¼ ì‚¬ìš©ì¤‘ì´ë¼ë©´ Lambda(ëŒ€ë¶€ë¶„ í´ë¼ìš°ë“œì—ì„œ ë™ì¼í•œ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.)
3. Github Action

ìš”êµ¬ì‚¬í•­ì„ ë‹¤ì‹œ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.


> ì¼ì • ì£¼ê¸° ë˜ëŠ” ì›í•˜ëŠ” ì‹œì ì— scriptë¥¼ ì‹¤í–‰í•  ì‹¤í–‰ í™˜ê²½


ìœ„ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ë¿ë§Œ ì•„ë‹ˆë¼ ê°œë°œì ì¸ ìš”êµ¬ì‚¬í•­ë„ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.


> ê´€ë¦¬ì˜ ìš©ì˜ì„±ê³¼ ë‚®ì€ ë¹„ìš©


ê²°ë¡  í™•ì¸


|                   | ì¼ì • ì£¼ê¸°           | ì›í•˜ëŠ” ì‹œì            | ê´€ë¦¬ì˜ ìš©ì˜ì„±           | ë‚®ì€ ë¹„ìš©            |
| ----------------- | --------------- | ---------------- | ----------------- | ---------------- |
| ì‹¤í–‰ì¤‘ì¸ ì„œë²„ì— êµ¬í˜„       | âœ…Â  - ìŠ¤ì¼€ì¤„ëŸ¬ ì‚¬ìš©    | âœ…Â - API êµ¬í˜„       | âŒÂ - ìœ ì§€ë³´ìˆ˜ì˜ ì–´ë ¤ì›€     | âœ…Â - ì‹¤í–‰ì¤‘ì¸ ìì› ì‚¬ìš©   |
| AWS Lambda        | âœ…Â - EventBridge | âœ…Â - Function URL | âŒÂ - ì¶”ê°€ì ì¸ ê´€ë¦¬ í•„ìš”    | âœ…Â - ì›” 100ë§Œ ê±´ì˜ ë¬´ë£Œ |
| **Github Action** | âœ…Â - corn        | âœ…Â - Event íŠ¸ë¦¬ê±°    | âœ…Â - githubì—ì„œ í†µí•©ê´€ë¦¬ | âœ…Â - ì›” 2000ë¶„ ë¬´ë£Œ   |

undefined

#### 2.1. ì‹¤í–‰ì¤‘ì¸ ì„œë²„ì— êµ¬í˜„ â†’ âŒ


API ì„œë²„ë‚˜ ë°°ì¹˜ ì„œë²„ëŠ” ëª¨ë‘ nestjsë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë•Œë¬¸ì— Script ì‹¤í–‰ ì½”ë“œë¥¼ êµ¬í˜„í•œë‹¤ë©´ ìŠ¤ì¼€ì¤„ë§ê³¼ APIë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¼ë°˜ì ì…ë‹ˆë‹¤.


í•˜ì§€ë§Œ ìœ ì§€ë³´ìˆ˜ì˜ ë¬¸ì œë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

- í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ê°€ ì•„ë‹Œ ì½”ë“œë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ë¥¼ ì±…ì„ì§€ëŠ” ì„œë²„ ë¡œì§ì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ ì§€ì–‘í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
- ê´€ë¦¬ì ì¸ ì¸¡ë©´ì—ì„œ í¸í•˜ì§€ ì•Šìœ¼ë©°, ì„œë²„ë¥¼ ì´ìš©í•˜ì§€ ì•Šë”ë¼ê³  ì¼ì‹œì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œëŠ” ì‚¬ìš©í•  í”Œë ›í¼ì´ ë§ë‹¤.


#### 2.2. AWS Lambda â†’ âŒ


Sitemap ë™ì  ìƒì„± ë°°í¬ ê´€ë ¨í•´ì„œ ë§ì´ ë‚˜ì˜¤ëŠ” í”Œë ›í¼ì€ AWSì˜ Lambdaë¥¼ ì‚¬ìš©í•˜ëŠ” í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
LambdaëŠ” EventBridge Schedulerë¥¼ ì‚¬ìš©í•´ì„œ ìŠ¤ì¼€ì¤„ë§ í•˜ëŠ” ë°©ì‹ì„ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤. 


í•˜ì§€ë§Œ í™˜ê²½ì ì¸ ì´ìœ ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê¸°ë¡œ í•©ë‹ˆë‹¤.

- í•˜ë‚˜ì˜ í´ë¼ìš°ë“œ í”Œë ›í¼ì— ì¢…ì†ì„ ê°€ëŠ¥í•˜ë©´ í”¼í•œë‹¤.
	- í¬ë˜ë”§ì„ ì œê³µí•˜ëŠ” í´ë¼ìš°ë“œë¥¼ ì ê·¹ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, í˜„ì¬ë„ NCPì™€ AWSë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.
- Sitemapì„ ìœ„í•´ Lambdaë¥¼ ì‚¬ìš©í•˜ë©´ **ì¶”ê°€ì ì¸ ê´€ë¦¬ ì§€ì ì´ ëŠ˜ì–´ë‚œë‹¤.**
	- ì´ë¯¸ ë§ì€ í™˜ê²½ì„ github actionì„ ì‚¬ìš©í•´ì„œ í•¸ë“¤ë§í•˜ê³  ìˆìœ¼ë©°, í•´ë‹¹ ìš”êµ¬ì‚¬í•­ë„ ì¶©ë¶„íˆ github actionì„ ì‚¬ìš©í•´ í•´ê²°ì´ ê°€ëŠ¥í•˜ë‹¤.
- ê°•ì œì„±ì´ ë‚®ì€ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ íŠ¹ì„±ìƒ Lambdaë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ìì£¼ AWS consoleì— ì ‘ì†í•˜ëŠ” ìƒí™©ì€ ë³´ì•ˆì ìœ¼ë¡œ ìœ„í—˜í•  ìˆ˜ ìˆë‹¤.


#### 2.3. Github Action â†’ âœ…


ì €í¬ ì„œë¹„ìŠ¤ëŠ” ì½”ë“œì˜ í˜•ìƒê´€ë¦¬ë¥¼ githubì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, githubì—ì„œëŠ” github actionì´ë¼ëŠ” ì‹¤í–‰í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤. (private ì €ì¥ì†Œì˜ ê²½ìš° í•œë‹¬ì— 2000ë¶„ ë¬´ë£Œ ì‚¬ìš©ì„ ì œê³µí•©ë‹ˆë‹¤.)


ì˜ ì•Œë ¤ì ¸ ìˆì§€ ì•Šì§€ë§Œ github actionì—ì„œëŠ” ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

- âœ…Â â€ì¼ì • ì£¼ê¸°": github action ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ ì‚¬ìš©
- âœ…Â â€ì›í•˜ëŠ” ì‹œì â€: github action ì´ë²¤íŠ¸ í˜¸ì¶œ, ì›Œí¬í”Œë¡œ ì¬ì‹¤í–‰
- âœ…Â ê´€ë¦¬ì˜ ìš©ì˜ì„±: github actionì—ì„œ ëŒ€ì‹œë³´ë“œë¡œ ë¡œê·¸ í™•ì¸ ê°€ëŠ¥
- âœ… ë‚®ì€ ë¹„ìš©: í•œë‹¬ 2000ë¶„ ë¬´ë£Œ


#### 2.4. ì •ì˜í•œ Github Action ì›Œí¬í”Œë¡œ YAML í™•ì¸



{% raw %}
```yaml
name: Generate Sitemap And Deploy
on:
  schedule:
    # ì°¸ê³  https://crontab.guru/
    # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ AM 4ì‹œì— ì‹¤í–‰ (UTC ê¸°ì¤€ ì „ë‚  PM 7ì‹œ)
    - cron: "0 19 * * *"
  push:
    tags:
      - generate-sitemap.[0-9]+
  # GitHub Actionsíƒ­ì—ì„œ ìˆ˜ë™ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
  workflow_dispatch:

# ë™ì‹œì„± ì„¤ì •: ê°™ì€ ê·¸ë£¹ì˜ ë°°í¬ê°€ ì—¬ëŸ¬ê°œ ì‹¤í–‰ë˜ë©´ ê°€ì¥ ë§ˆì§€ë§‰ì— ì‹¤í–‰ëœ ë°°í¬ì™¸ì—ëŠ” ì·¨ì†Œ ì‹œí‚¨ë‹¤.
## [ì°¸ê³ ](https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#example-using-concurrency-to-cancel-any-in-progress-job-or-run)
concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy:
    name: Generate-Sitemap-and-Deploy
    runs-on: ubuntu-22.04
    timeout-minutes: 10 # 10ë¶„
    env: # deploy jobì˜ ì „ì—­ í™˜ê²½ë³€ìˆ˜ ì •ì˜
      AWS_S3_BUCKET_URL: s3://${bucketURL}
      AWS_CLOUDFRONT_DISTRIBUTION_ID: ${cloudFrontId}
      WORKING_DIR: ./package/script-generate-sitemap
      CACHE_KEY_LABLE: script-generate-sitemap
    strategy:
      matrix:
        node-version: [v20.15.0]

    steps:
      # 1. actionì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ action ì „ìš© ë¸Œëœì¹˜ë¡œ checkout
      - name: Checkout actions Repository
        uses: actions/checkout@v2
      # 2. node ë²„ì „ ì„¤ì •
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      # 4. node_modules ìºì‹œ ì„¤ì •
      # docs: https://github.com/actions/cache
      # outputs: cache.outputs.cache-hit - ìºì‹œê°€ ì¡´ì¬í•˜ë©´ true, ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ false
      - name: Cache node_modules
        id: cache
        uses: actions/cache@v3
        with:
          # cacheì˜ ëŒ€ìƒì„ ì •í•œë‹¤.
          path: "**/node_modules"
          # ë¬´íš¨í™”ì˜ ê¸°ì¤€ì´ ë˜ëŠ” cacheì˜ keyë¥¼ ì •í•œë‹¤.
          key: ${{ runner.os }}-${{ env.CACHE_KEY_LABLE }}-${{ hashFiles(format('{0}/package-lock.json', env.WORKING_DIR)) }}
          # keyê°€ ê¹¨ì¡Œì„ë•Œ ë³µêµ¬í•˜ëŠ” ë°©ë²• ëª…ì‹œ, "${{ runner.os }}-node-" ì™€ ì¼ì¹˜í•˜ëŠ” ìºì‹œë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•œë‹¤.
          restore-keys: ${{ runner.os }}-node-
          working-directory: ${{ env.WORKING_DIR }}
          
      # 5. Cache Hit ì‹¤íŒ¨: ì¼ì¹˜í•˜ëŠ” ìºì‹œê°€ ì—†ë‹¤ë©´ node_modules ì„¤ì¹˜
      - name: Install Dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm ci
        working-directory: ${{ env.WORKING_DIR }}

      # 6. Sitemap ìƒì„± - Script ì‹¤í–‰
      - name: Generate Sitemap
        run: npm run start
        working-directory: ${{ env.WORKING_DIR }}
      
      # 7. ìƒì„±ëœ Sitemap S3ì— ë°°í¬
      - name: Copy files to the test website with the AWS CLI
        run: |
          aws s3 cp ./sitemap ${{ env.AWS_S3_BUCKET_URL }} --recursive
        working-directory: ${{ env.WORKING_DIR }}
        
      # 8. Cloudfront ìºì‹œ ë¬´íš¨í™” ìƒì„±
      - name: Invalidate Cloudfront Cache
        uses: chetan/invalidate-cloudfront-action@master
        env:
          DISTRIBUTION: ${{ env.AWS_CLOUDFRONT_DISTRIBUTION_ID }}
          PATHS: "/*"
        continue-on-error: true
```
{% endraw %}



**ì›Œí¬í”Œë¡œì— ì ìš©ëœ ì„¤ì •**

- scheduleë¡œ ì‹¤í–‰
- tag ë°°í¬ë¡œ ì‹¤í–‰
- ê°™ì€ ì›Œí¬í”Œë¡œ ë™ì‹œ ì‹¤í–‰ ë°©ì§€: `concurrency`
- ì›Œí¬í”Œë¡œ ìˆ˜ë™ìœ¼ë¡œ ì¬ì‹¤í–‰ ì„¤ì •: `workflow_dispatch`
- `node_modules` ìºì‹± ì„¤ì •

**ì›Œí¬í”Œë¡œì˜ ìˆœì„œ**

1. actionì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ action ì „ìš© ë¸Œëœì¹˜ë¡œ checkout
2. node ë²„ì „ ì„¤ì •
3. AWS cli ìê²©ì¦ëª… ì„¤ì •
4. `node_modules` Cache ì„¤ì •
5. Cache Hit ì‹¤íŒ¨: ì¼ì¹˜í•˜ëŠ” ìºì‹œê°€ ì—†ë‹¤ë©´ `node_modules` ì„¤ì¹˜
6. Sitemap ìƒì„± - Script ì‹¤í–‰
7. ìƒì„±ëœ Sitemap S3ì— ë°°í¬
8. Cloudfront ìºì‹œ ë¬´íš¨í™” ìƒì„±


### ì°¸ê³ 

- [google search console ê³µì‹ ë¬¸ì„œ > ì‚¬ì´íŠ¸ë§µ ì œì‘ ë° ì œì¶œí•˜ê¸°](https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap?hl=ko)
- [Sitemapì—ì„œ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì€?](https://m.blog.naver.com/suin2_91/221342308411)
- [sitemap í”„ë¡œí† ì½œ](https://www.sitemaps.org/protocol.html#changefreqdef)
- [ë‹¤ë‚˜ì™€ ì‚¬ì´íŠ¸ë§µ ì˜ˆì‹œ](https://prod.danawa.com/sitemap.xml)
